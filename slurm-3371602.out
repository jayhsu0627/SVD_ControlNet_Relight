NODELIST=gammagpu17
MASTER_ADDR=gammagpu17
[2024-11-29 17:05:01,791] [INFO] [real_accelerator.py:219:get_accelerator] Setting ds_accelerator to cuda (auto detect)
[2024-11-29 17:05:01,794] [INFO] [real_accelerator.py:219:get_accelerator] Setting ds_accelerator to cuda (auto detect)
[2024-11-29 17:05:01,795] [INFO] [real_accelerator.py:219:get_accelerator] Setting ds_accelerator to cuda (auto detect)
[2024-11-29 17:05:01,795] [INFO] [real_accelerator.py:219:get_accelerator] Setting ds_accelerator to cuda (auto detect)
W1129 17:05:04.125396 139874292712448 torch/distributed/run.py:779] 
W1129 17:05:04.125396 139874292712448 torch/distributed/run.py:779] *****************************************
W1129 17:05:04.125396 139874292712448 torch/distributed/run.py:779] Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
W1129 17:05:04.125396 139874292712448 torch/distributed/run.py:779] *****************************************
W1129 17:05:04.125958 140620076798976 torch/distributed/run.py:779] 
W1129 17:05:04.125958 140620076798976 torch/distributed/run.py:779] *****************************************
W1129 17:05:04.125958 140620076798976 torch/distributed/run.py:779] Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
W1129 17:05:04.125958 140620076798976 torch/distributed/run.py:779] *****************************************
W1129 17:05:04.134846 139927969387520 torch/distributed/run.py:779] 
W1129 17:05:04.134846 139927969387520 torch/distributed/run.py:779] *****************************************
W1129 17:05:04.134846 139927969387520 torch/distributed/run.py:779] Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
W1129 17:05:04.134846 139927969387520 torch/distributed/run.py:779] *****************************************
W1129 17:05:04.135597 140489304970240 torch/distributed/run.py:779] 
W1129 17:05:04.135597 140489304970240 torch/distributed/run.py:779] *****************************************
W1129 17:05:04.135597 140489304970240 torch/distributed/run.py:779] Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
W1129 17:05:04.135597 140489304970240 torch/distributed/run.py:779] *****************************************
Warning: The cache directory for DeepSpeed Triton autotune, /fs/nexus-scratch/sjxu/.triton/autotune, appears to be on an NFS system. While this is generally acceptable, if you experience slowdowns or hanging when DeepSpeed exits, it is recommended to set the TRITON_CACHE_DIR environment variable to a non-NFS path.
Traceback (most recent call last):
  File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/bin/accelerate", line 8, in <module>
    sys.exit(main())
  File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/accelerate/commands/accelerate_cli.py", line 48, in main
    args.func(args)
  File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/accelerate/commands/launch.py", line 1153, in launch_command
    deepspeed_launcher(args)
  File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/accelerate/commands/launch.py", line 846, in deepspeed_launcher
    distrib_run.run(args)
  File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/torch/distributed/run.py", line 892, in run
    elastic_launch(
  File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/torch/distributed/launcher/api.py", line 133, in __call__
    return launch_agent(self._config, self._entrypoint, list(args))
  File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/torch/distributed/launcher/api.py", line 255, in launch_agent
    result = agent.run()
  File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/torch/distributed/elastic/metrics/api.py", line 124, in wrapper
    result = f(*args, **kwargs)
  File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/torch/distributed/elastic/agent/server/api.py", line 680, in run
    result = self._invoke_run(role)
  File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/torch/distributed/elastic/agent/server/api.py", line 829, in _invoke_run
    self._initialize_workers(self._worker_group)
  File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/torch/distributed/elastic/metrics/api.py", line 124, in wrapper
Warning: The cache directory for DeepSpeed Triton autotune, /fs/nexus-scratch/sjxu/.triton/autotune, appears to be on an NFS system. While this is generally acceptable, if you experience slowdowns or hanging when DeepSpeed exits, it is recommended to set the TRITON_CACHE_DIR environment variable to a non-NFS path.
Traceback (most recent call last):
  File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/bin/accelerate", line 8, in <module>
    sys.exit(main())
  File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/accelerate/commands/accelerate_cli.py", line 48, in main
    args.func(args)
  File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/accelerate/commands/launch.py", line 1153, in launch_command
    deepspeed_launcher(args)
  File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/accelerate/commands/launch.py", line 846, in deepspeed_launcher
    distrib_run.run(args)
  File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/torch/distributed/run.py", line 892, in run
    elastic_launch(
  File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/torch/distributed/launcher/api.py", line 133, in __call__
    return launch_agent(self._config, self._entrypoint, list(args))
  File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/torch/distributed/launcher/api.py", line 255, in launch_agent
    result = agent.run()
  File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/torch/distributed/elastic/metrics/api.py", line 124, in wrapper
    result = f(*args, **kwargs)
  File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/torch/distributed/elastic/agent/server/api.py", line 680, in run
    result = self._invoke_run(role)
  File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/torch/distributed/elastic/agent/server/api.py", line 829, in _invoke_run
Warning: The cache directory for DeepSpeed Triton autotune, /fs/nexus-scratch/sjxu/.triton/autotune, appears to be on an NFS system. While this is generally acceptable, if you experience slowdowns or hanging when DeepSpeed exits, it is recommended to set the TRITON_CACHE_DIR environment variable to a non-NFS path.
Traceback (most recent call last):
  File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/bin/accelerate", line 8, in <module>
    sys.exit(main())
  File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/accelerate/commands/accelerate_cli.py", line 48, in main
    args.func(args)
  File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/accelerate/commands/launch.py", line 1153, in launch_command
    deepspeed_launcher(args)
  File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/accelerate/commands/launch.py", line 846, in deepspeed_launcher
    distrib_run.run(args)
  File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/torch/distributed/run.py", line 892, in run
    elastic_launch(
  File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/torch/distributed/launcher/api.py", line 133, in __call__
    return launch_agent(self._config, self._entrypoint, list(args))
  File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/torch/distributed/launcher/api.py", line 255, in launch_agent
    result = agent.run()
  File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/torch/distributed/elastic/metrics/api.py", line 124, in wrapper
    result = f(*args, **kwargs)
  File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/torch/distributed/elastic/agent/server/api.py", line 680, in run
    result = self._invoke_run(role)
  File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/torch/distributed/elastic/agent/server/api.py", line 829, in _invoke_run
    self._initialize_workers(self._worker_group)
  File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/torch/distributed/elastic/metrics/api.py", line 124, in wrapper
    result = f(*args, **kwargs)
  File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/torch/distributed/elastic/agent/server/api.py", line 652, in _initialize_workers
    self._initialize_workers(self._worker_group)
  File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/torch/distributed/elastic/metrics/api.py", line 124, in wrapper
    self._rendezvous(worker_group)
  File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/torch/distributed/elastic/metrics/api.py", line 124, in wrapper
    result = f(*args, **kwargs)
  File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/torch/distributed/elastic/agent/server/api.py", line 652, in _initialize_workers
    result = f(*args, **kwargs)
  File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/torch/distributed/elastic/agent/server/api.py", line 652, in _initialize_workers
    result = f(*args, **kwargs)
  File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/torch/distributed/elastic/agent/server/api.py", line 489, in _rendezvous
    self._rendezvous(worker_group)
  File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/torch/distributed/elastic/metrics/api.py", line 124, in wrapper
    self._rendezvous(worker_group)
  File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/torch/distributed/elastic/metrics/api.py", line 124, in wrapper
    rdzv_info = spec.rdzv_handler.next_rendezvous()
  File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/torch/distributed/elastic/rendezvous/static_tcp_rendezvous.py", line 66, in next_rendezvous
    result = f(*args, **kwargs)
  File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/torch/distributed/elastic/agent/server/api.py", line 489, in _rendezvous
    result = f(*args, **kwargs)
  File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/torch/distributed/elastic/agent/server/api.py", line 489, in _rendezvous
    self._store = TCPStore(  # type: ignore[call-arg]
RuntimeError: The server socket has failed to listen on any local network address. useIpv6: 0, code: -98, name: EADDRINUSE, message: address already in use
    rdzv_info = spec.rdzv_handler.next_rendezvous()
  File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/torch/distributed/elastic/rendezvous/static_tcp_rendezvous.py", line 66, in next_rendezvous
    rdzv_info = spec.rdzv_handler.next_rendezvous()
  File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/torch/distributed/elastic/rendezvous/static_tcp_rendezvous.py", line 66, in next_rendezvous
    self._store = TCPStore(  # type: ignore[call-arg]
RuntimeError: The server socket has failed to listen on any local network address. useIpv6: 0, code: -98, name: EADDRINUSE, message: address already in use
    self._store = TCPStore(  # type: ignore[call-arg]
RuntimeError: The server socket has failed to listen on any local network address. useIpv6: 0, code: -98, name: EADDRINUSE, message: address already in use
srun: error: gammagpu17: tasks 2-3: Exited with exit code 1
srun: error: gammagpu17: task 1: Exited with exit code 1
/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/diffusers/utils/outputs.py:63: FutureWarning: `torch.utils._pytree._register_pytree_node` is deprecated. Please use `torch.utils._pytree.register_pytree_node` instead.
  torch.utils._pytree._register_pytree_node(
/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/diffusers/utils/outputs.py:63: FutureWarning: `torch.utils._pytree._register_pytree_node` is deprecated. Please use `torch.utils._pytree.register_pytree_node` instead.
  torch.utils._pytree._register_pytree_node(
/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/diffusers/utils/outputs.py:63: FutureWarning: `torch.utils._pytree._register_pytree_node` is deprecated. Please use `torch.utils._pytree.register_pytree_node` instead.
  torch.utils._pytree._register_pytree_node(
/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/diffusers/utils/outputs.py:63: FutureWarning: `torch.utils._pytree._register_pytree_node` is deprecated. Please use `torch.utils._pytree.register_pytree_node` instead.
  torch.utils._pytree._register_pytree_node(
/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/xformers/ops/fmha/flash.py:211: FutureWarning: `torch.library.impl_abstract` was renamed to `torch.library.register_fake`. Please use that instead; we will remove `torch.library.impl_abstract` in a future version of PyTorch.
  @torch.library.impl_abstract("xformers_flash::flash_fwd")
/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/xformers/ops/fmha/flash.py:211: FutureWarning: `torch.library.impl_abstract` was renamed to `torch.library.register_fake`. Please use that instead; we will remove `torch.library.impl_abstract` in a future version of PyTorch.
  @torch.library.impl_abstract("xformers_flash::flash_fwd")
/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/xformers/ops/fmha/flash.py:211: FutureWarning: `torch.library.impl_abstract` was renamed to `torch.library.register_fake`. Please use that instead; we will remove `torch.library.impl_abstract` in a future version of PyTorch.
  @torch.library.impl_abstract("xformers_flash::flash_fwd")
/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/xformers/ops/fmha/flash.py:211: FutureWarning: `torch.library.impl_abstract` was renamed to `torch.library.register_fake`. Please use that instead; we will remove `torch.library.impl_abstract` in a future version of PyTorch.
  @torch.library.impl_abstract("xformers_flash::flash_fwd")
/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/xformers/ops/fmha/flash.py:344: FutureWarning: `torch.library.impl_abstract` was renamed to `torch.library.register_fake`. Please use that instead; we will remove `torch.library.impl_abstract` in a future version of PyTorch.
  @torch.library.impl_abstract("xformers_flash::flash_bwd")
/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/xformers/ops/fmha/flash.py:344: FutureWarning: `torch.library.impl_abstract` was renamed to `torch.library.register_fake`. Please use that instead; we will remove `torch.library.impl_abstract` in a future version of PyTorch.
  @torch.library.impl_abstract("xformers_flash::flash_bwd")
/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/xformers/ops/fmha/flash.py:344: FutureWarning: `torch.library.impl_abstract` was renamed to `torch.library.register_fake`. Please use that instead; we will remove `torch.library.impl_abstract` in a future version of PyTorch.
  @torch.library.impl_abstract("xformers_flash::flash_bwd")
/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/xformers/ops/fmha/flash.py:344: FutureWarning: `torch.library.impl_abstract` was renamed to `torch.library.register_fake`. Please use that instead; we will remove `torch.library.impl_abstract` in a future version of PyTorch.
  @torch.library.impl_abstract("xformers_flash::flash_bwd")
/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/kornia/feature/lightglue.py:44: FutureWarning: `torch.cuda.amp.custom_fwd(args...)` is deprecated. Please use `torch.amp.custom_fwd(args..., device_type='cuda')` instead.
  @torch.cuda.amp.custom_fwd(cast_inputs=torch.float32)
/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/kornia/feature/lightglue.py:44: FutureWarning: `torch.cuda.amp.custom_fwd(args...)` is deprecated. Please use `torch.amp.custom_fwd(args..., device_type='cuda')` instead.
  @torch.cuda.amp.custom_fwd(cast_inputs=torch.float32)
/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/kornia/feature/lightglue.py:44: FutureWarning: `torch.cuda.amp.custom_fwd(args...)` is deprecated. Please use `torch.amp.custom_fwd(args..., device_type='cuda')` instead.
  @torch.cuda.amp.custom_fwd(cast_inputs=torch.float32)
/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/kornia/feature/lightglue.py:44: FutureWarning: `torch.cuda.amp.custom_fwd(args...)` is deprecated. Please use `torch.amp.custom_fwd(args..., device_type='cuda')` instead.
  @torch.cuda.amp.custom_fwd(cast_inputs=torch.float32)
/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/accelerate/utils/dataclasses.py:1183: UserWarning: DeepSpeed Zero3 Init flag is only applicable for ZeRO Stage 3. Setting it to False.
  warnings.warn("DeepSpeed Zero3 Init flag is only applicable for ZeRO Stage 3. Setting it to False.")
/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/accelerate/utils/dataclasses.py:1183: UserWarning: DeepSpeed Zero3 Init flag is only applicable for ZeRO Stage 3. Setting it to False.
  warnings.warn("DeepSpeed Zero3 Init flag is only applicable for ZeRO Stage 3. Setting it to False.")
/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/accelerate/utils/dataclasses.py:1183: UserWarning: DeepSpeed Zero3 Init flag is only applicable for ZeRO Stage 3. Setting it to False.
  warnings.warn("DeepSpeed Zero3 Init flag is only applicable for ZeRO Stage 3. Setting it to False.")
/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/accelerate/utils/dataclasses.py:1183: UserWarning: DeepSpeed Zero3 Init flag is only applicable for ZeRO Stage 3. Setting it to False.
  warnings.warn("DeepSpeed Zero3 Init flag is only applicable for ZeRO Stage 3. Setting it to False.")
[2024-11-29 17:05:09,663] [INFO] [real_accelerator.py:219:get_accelerator] Setting ds_accelerator to cuda (auto detect)
[2024-11-29 17:05:09,664] [INFO] [real_accelerator.py:219:get_accelerator] Setting ds_accelerator to cuda (auto detect)
[2024-11-29 17:05:09,665] [INFO] [real_accelerator.py:219:get_accelerator] Setting ds_accelerator to cuda (auto detect)
[2024-11-29 17:05:09,669] [INFO] [real_accelerator.py:219:get_accelerator] Setting ds_accelerator to cuda (auto detect)
Warning: The cache directory for DeepSpeed Triton autotune, /fs/nexus-scratch/sjxu/.triton/autotune, appears to be on an NFS system. While this is generally acceptable, if you experience slowdowns or hanging when DeepSpeed exits, it is recommended to set the TRITON_CACHE_DIR environment variable to a non-NFS path.
Warning: The cache directory for DeepSpeed Triton autotune, /fs/nexus-scratch/sjxu/.triton/autotune, appears to be on an NFS system. While this is generally acceptable, if you experience slowdowns or hanging when DeepSpeed exits, it is recommended to set the TRITON_CACHE_DIR environment variable to a non-NFS path.
Warning: The cache directory for DeepSpeed Triton autotune, /fs/nexus-scratch/sjxu/.triton/autotune, appears to be on an NFS system. While this is generally acceptable, if you experience slowdowns or hanging when DeepSpeed exits, it is recommended to set the TRITON_CACHE_DIR environment variable to a non-NFS path.
Warning: The cache directory for DeepSpeed Triton autotune, /fs/nexus-scratch/sjxu/.triton/autotune, appears to be on an NFS system. While this is generally acceptable, if you experience slowdowns or hanging when DeepSpeed exits, it is recommended to set the TRITON_CACHE_DIR environment variable to a non-NFS path.
[2024-11-29 17:05:11,084] [INFO] [comm.py:652:init_distributed] cdb=None
[2024-11-29 17:05:11,084] [INFO] [comm.py:683:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
[2024-11-29 17:05:11,089] [INFO] [comm.py:652:init_distributed] cdb=None
[2024-11-29 17:05:11,091] [INFO] [comm.py:652:init_distributed] cdb=None
[2024-11-29 17:05:11,108] [INFO] [comm.py:652:init_distributed] cdb=None
/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/transformers/deepspeed.py:24: FutureWarning: transformers.deepspeed module is deprecated and will be removed in a future version. Please import deepspeed modules directly from transformers.integrations
  warnings.warn(
Detected kernel version 4.18.0, which is below the recommended minimum of 5.5.0; this can cause the process to hang. It is recommended to upgrade the kernel to the minimum version or higher.
/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/transformers/deepspeed.py:24: FutureWarning: transformers.deepspeed module is deprecated and will be removed in a future version. Please import deepspeed modules directly from transformers.integrations
  warnings.warn(
/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/transformers/deepspeed.py:24: FutureWarning: transformers.deepspeed module is deprecated and will be removed in a future version. Please import deepspeed modules directly from transformers.integrations
  warnings.warn(
/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/transformers/deepspeed.py:24: FutureWarning: transformers.deepspeed module is deprecated and will be removed in a future version. Please import deepspeed modules directly from transformers.integrations
  warnings.warn(
wandb: Currently logged in as: sjxu (sjxu_gamma). Use `wandb login --relogin` to force relogin
wandb: Appending key for api.wandb.ai to your netrc file: /fs/nexus-scratch/sjxu/.netrc
11/29/2024 17:05:12 - INFO - __main__ - Distributed environment: DEEPSPEED  Backend: nccl
Num processes: 4
Process index: 0
Local process index: 0
Device: cuda:0

Mixed precision type: fp16
ds_config: {'bf16': {'enabled': False}, 'zero_optimization': {'stage': 2, 'offload_optimizer': {'device': 'cpu', 'pin_memory': True}}, 'gradient_accumulation_steps': 1, 'gradient_clipping': 'auto', 'train_batch_size': 'auto', 'train_micro_batch_size_per_gpu': 'auto', 'steps_per_print': inf, 'fp16': {'enabled': True, 'auto_cast': True}}

/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/huggingface_hub/file_download.py:1150: FutureWarning: `resume_download` is deprecated and will be removed in version 1.0.0. Downloads always resume when possible. If you want to force a new download, use `force_download=True`.
  warnings.warn(
wandb: Currently logged in as: sjxu (sjxu_gamma). Use `wandb login --relogin` to force relogin
wandb: Currently logged in as: sjxu (sjxu_gamma). Use `wandb login --relogin` to force relogin
wandb: Appending key for api.wandb.ai to your netrc file: /fs/nexus-scratch/sjxu/.netrc
wandb: Appending key for api.wandb.ai to your netrc file: /fs/nexus-scratch/sjxu/.netrc
wandb: Currently logged in as: sjxu (sjxu_gamma). Use `wandb login --relogin` to force relogin
wandb: Appending key for api.wandb.ai to your netrc file: /fs/nexus-scratch/sjxu/.netrc
/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/diffusers/utils/outputs.py:63: FutureWarning: `torch.utils._pytree._register_pytree_node` is deprecated. Please use `torch.utils._pytree.register_pytree_node` instead.
  torch.utils._pytree._register_pytree_node(
{'rescale_betas_zero_snr'} was not found in config. Values will be initialized to default values.
11/29/2024 17:05:12 - INFO - __main__ - Distributed environment: DEEPSPEED  Backend: nccl
Num processes: 4
Process index: 1
Local process index: 1
Device: cuda:1

Mixed precision type: fp16
ds_config: {'bf16': {'enabled': False}, 'zero_optimization': {'stage': 2, 'offload_optimizer': {'device': 'cpu', 'pin_memory': True}}, 'gradient_accumulation_steps': 1, 'gradient_clipping': 'auto', 'train_batch_size': 'auto', 'train_micro_batch_size_per_gpu': 'auto', 'steps_per_print': inf, 'fp16': {'enabled': True, 'auto_cast': True}}

/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/huggingface_hub/file_download.py:1150: FutureWarning: `resume_download` is deprecated and will be removed in version 1.0.0. Downloads always resume when possible. If you want to force a new download, use `force_download=True`.
  warnings.warn(
11/29/2024 17:05:12 - INFO - __main__ - Distributed environment: DEEPSPEED  Backend: nccl
Num processes: 4
Process index: 3
Local process index: 3
Device: cuda:3

Mixed precision type: fp16
ds_config: {'bf16': {'enabled': False}, 'zero_optimization': {'stage': 2, 'offload_optimizer': {'device': 'cpu', 'pin_memory': True}}, 'gradient_accumulation_steps': 1, 'gradient_clipping': 'auto', 'train_batch_size': 'auto', 'train_micro_batch_size_per_gpu': 'auto', 'steps_per_print': inf, 'fp16': {'enabled': True, 'auto_cast': True}}

/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/huggingface_hub/file_download.py:1150: FutureWarning: `resume_download` is deprecated and will be removed in version 1.0.0. Downloads always resume when possible. If you want to force a new download, use `force_download=True`.
  warnings.warn(
11/29/2024 17:05:12 - INFO - __main__ - Distributed environment: DEEPSPEED  Backend: nccl
Num processes: 4
Process index: 2
Local process index: 2
Device: cuda:2

Mixed precision type: fp16
ds_config: {'bf16': {'enabled': False}, 'zero_optimization': {'stage': 2, 'offload_optimizer': {'device': 'cpu', 'pin_memory': True}}, 'gradient_accumulation_steps': 1, 'gradient_clipping': 'auto', 'train_batch_size': 'auto', 'train_micro_batch_size_per_gpu': 'auto', 'steps_per_print': inf, 'fp16': {'enabled': True, 'auto_cast': True}}

/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/huggingface_hub/file_download.py:1150: FutureWarning: `resume_download` is deprecated and will be removed in version 1.0.0. Downloads always resume when possible. If you want to force a new download, use `force_download=True`.
  warnings.warn(
/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/diffusers/utils/outputs.py:63: FutureWarning: `torch.utils._pytree._register_pytree_node` is deprecated. Please use `torch.utils._pytree.register_pytree_node` instead.
  torch.utils._pytree._register_pytree_node(
/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/diffusers/utils/outputs.py:63: FutureWarning: `torch.utils._pytree._register_pytree_node` is deprecated. Please use `torch.utils._pytree.register_pytree_node` instead.
  torch.utils._pytree._register_pytree_node(
/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/diffusers/utils/outputs.py:63: FutureWarning: `torch.utils._pytree._register_pytree_node` is deprecated. Please use `torch.utils._pytree.register_pytree_node` instead.
  torch.utils._pytree._register_pytree_node(
Setting up [LPIPS] perceptual loss: trunk [alex], v[0.1], spatial [off]
/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/torchvision/models/_utils.py:208: UserWarning: The parameter 'pretrained' is deprecated since 0.13 and may be removed in the future, please use 'weights' instead.
  warnings.warn(
/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/torchvision/models/_utils.py:223: UserWarning: Arguments other than a weight enum or `None` for 'weights' are deprecated since 0.13 and may be removed in the future. The current behavior is equivalent to passing `weights=AlexNet_Weights.IMAGENET1K_V1`. You can also use `weights=AlexNet_Weights.DEFAULT` to get the most up-to-date weights.
  warnings.warn(msg)
Setting up [LPIPS] perceptual loss: trunk [alex], v[0.1], spatial [off]
Setting up [LPIPS] perceptual loss: trunk [alex], v[0.1], spatial [off]
/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/torchvision/models/_utils.py:208: UserWarning: The parameter 'pretrained' is deprecated since 0.13 and may be removed in the future, please use 'weights' instead.
  warnings.warn(
/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/torchvision/models/_utils.py:208: UserWarning: The parameter 'pretrained' is deprecated since 0.13 and may be removed in the future, please use 'weights' instead.
  warnings.warn(
/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/torchvision/models/_utils.py:223: UserWarning: Arguments other than a weight enum or `None` for 'weights' are deprecated since 0.13 and may be removed in the future. The current behavior is equivalent to passing `weights=AlexNet_Weights.IMAGENET1K_V1`. You can also use `weights=AlexNet_Weights.DEFAULT` to get the most up-to-date weights.
  warnings.warn(msg)
/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/torchvision/models/_utils.py:223: UserWarning: Arguments other than a weight enum or `None` for 'weights' are deprecated since 0.13 and may be removed in the future. The current behavior is equivalent to passing `weights=AlexNet_Weights.IMAGENET1K_V1`. You can also use `weights=AlexNet_Weights.DEFAULT` to get the most up-to-date weights.
  warnings.warn(msg)
Setting up [LPIPS] perceptual loss: trunk [alex], v[0.1], spatial [off]
/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/torchvision/models/_utils.py:208: UserWarning: The parameter 'pretrained' is deprecated since 0.13 and may be removed in the future, please use 'weights' instead.
  warnings.warn(
/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/torchvision/models/_utils.py:223: UserWarning: Arguments other than a weight enum or `None` for 'weights' are deprecated since 0.13 and may be removed in the future. The current behavior is equivalent to passing `weights=AlexNet_Weights.IMAGENET1K_V1`. You can also use `weights=AlexNet_Weights.DEFAULT` to get the most up-to-date weights.
  warnings.warn(msg)
Loading model from: /fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/lpips/weights/v0.1/alex.pth
/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/lpips/lpips.py:107: FutureWarning: You are using `torch.load` with `weights_only=False` (the current default value), which uses the default pickle module implicitly. It is possible to construct malicious pickle data which will execute arbitrary code during unpickling (See https://github.com/pytorch/pytorch/blob/main/SECURITY.md#untrusted-models for more details). In a future release, the default value for `weights_only` will be flipped to `True`. This limits the functions that could be executed during unpickling. Arbitrary objects will no longer be allowed to be loaded via this mode unless they are explicitly allowlisted by the user via `torch.serialization.add_safe_globals`. We recommend you start setting `weights_only=True` for any use case where you don't have full control of the loaded file. Please open an issue on GitHub for any issues related to this experimental feature.
  self.load_state_dict(torch.load(model_path, map_location='cpu'), strict=False)
Loading model from: /fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/lpips/weights/v0.1/alex.pthLoading model from: /fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/lpips/weights/v0.1/alex.pth

/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/lpips/lpips.py:107: FutureWarning: You are using `torch.load` with `weights_only=False` (the current default value), which uses the default pickle module implicitly. It is possible to construct malicious pickle data which will execute arbitrary code during unpickling (See https://github.com/pytorch/pytorch/blob/main/SECURITY.md#untrusted-models for more details). In a future release, the default value for `weights_only` will be flipped to `True`. This limits the functions that could be executed during unpickling. Arbitrary objects will no longer be allowed to be loaded via this mode unless they are explicitly allowlisted by the user via `torch.serialization.add_safe_globals`. We recommend you start setting `weights_only=True` for any use case where you don't have full control of the loaded file. Please open an issue on GitHub for any issues related to this experimental feature.
  self.load_state_dict(torch.load(model_path, map_location='cpu'), strict=False)
/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/lpips/lpips.py:107: FutureWarning: You are using `torch.load` with `weights_only=False` (the current default value), which uses the default pickle module implicitly. It is possible to construct malicious pickle data which will execute arbitrary code during unpickling (See https://github.com/pytorch/pytorch/blob/main/SECURITY.md#untrusted-models for more details). In a future release, the default value for `weights_only` will be flipped to `True`. This limits the functions that could be executed during unpickling. Arbitrary objects will no longer be allowed to be loaded via this mode unless they are explicitly allowlisted by the user via `torch.serialization.add_safe_globals`. We recommend you start setting `weights_only=True` for any use case where you don't have full control of the loaded file. Please open an issue on GitHub for any issues related to this experimental feature.
  self.load_state_dict(torch.load(model_path, map_location='cpu'), strict=False)
Loading model from: /fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/lpips/weights/v0.1/alex.pth
/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/lpips/lpips.py:107: FutureWarning: You are using `torch.load` with `weights_only=False` (the current default value), which uses the default pickle module implicitly. It is possible to construct malicious pickle data which will execute arbitrary code during unpickling (See https://github.com/pytorch/pytorch/blob/main/SECURITY.md#untrusted-models for more details). In a future release, the default value for `weights_only` will be flipped to `True`. This limits the functions that could be executed during unpickling. Arbitrary objects will no longer be allowed to be loaded via this mode unless they are explicitly allowlisted by the user via `torch.serialization.add_safe_globals`. We recommend you start setting `weights_only=True` for any use case where you don't have full control of the loaded file. Please open an issue on GitHub for any issues related to this experimental feature.
  self.load_state_dict(torch.load(model_path, map_location='cpu'), strict=False)
FrozenDict([('sample_size', 96), ('in_channels', 8), ('out_channels', 4), ('down_block_types', ['CrossAttnDownBlockSpatioTemporal', 'CrossAttnDownBlockSpatioTemporal', 'CrossAttnDownBlockSpatioTemporal', 'DownBlockSpatioTemporal']), ('up_block_types', ['UpBlockSpatioTemporal', 'CrossAttnUpBlockSpatioTemporal', 'CrossAttnUpBlockSpatioTemporal', 'CrossAttnUpBlockSpatioTemporal']), ('block_out_channels', [320, 640, 1280, 1280]), ('addition_time_embed_dim', 256), ('projection_class_embeddings_input_dim', 768), ('layers_per_block', 2), ('cross_attention_dim', 1024), ('transformer_layers_per_block', 1), ('num_attention_heads', [5, 10, 20, 20]), ('num_frames', 14), ('_class_name', 'UNetSpatioTemporalConditionModel'), ('_diffusers_version', '0.24.0.dev0'), ('_name_or_path', 'stabilityai/stable-video-diffusion-img2vid')])
layers per block is 2
11/29/2024 17:05:15 - INFO - __main__ - Initializing controlnet weights from unet
FrozenDict([('sample_size', 96), ('in_channels', 8), ('out_channels', 4), ('down_block_types', ['CrossAttnDownBlockSpatioTemporal', 'CrossAttnDownBlockSpatioTemporal', 'CrossAttnDownBlockSpatioTemporal', 'DownBlockSpatioTemporal']), ('up_block_types', ['UpBlockSpatioTemporal', 'CrossAttnUpBlockSpatioTemporal', 'CrossAttnUpBlockSpatioTemporal', 'CrossAttnUpBlockSpatioTemporal']), ('block_out_channels', [320, 640, 1280, 1280]), ('addition_time_embed_dim', 256), ('projection_class_embeddings_input_dim', 768), ('layers_per_block', 2), ('cross_attention_dim', 1024), ('transformer_layers_per_block', 1), ('num_attention_heads', [5, 10, 20, 20]), ('num_frames', 14), ('_class_name', 'UNetSpatioTemporalConditionModel'), ('_diffusers_version', '0.24.0.dev0'), ('_name_or_path', 'stabilityai/stable-video-diffusion-img2vid')])
layers per block is 2
FrozenDict([('sample_size', 96), ('in_channels', 8), ('out_channels', 4), ('down_block_types', ['CrossAttnDownBlockSpatioTemporal', 'CrossAttnDownBlockSpatioTemporal', 'CrossAttnDownBlockSpatioTemporal', 'DownBlockSpatioTemporal']), ('up_block_types', ['UpBlockSpatioTemporal', 'CrossAttnUpBlockSpatioTemporal', 'CrossAttnUpBlockSpatioTemporal', 'CrossAttnUpBlockSpatioTemporal']), ('block_out_channels', [320, 640, 1280, 1280]), ('addition_time_embed_dim', 256), ('projection_class_embeddings_input_dim', 768), ('layers_per_block', 2), ('cross_attention_dim', 1024), ('transformer_layers_per_block', 1), ('num_attention_heads', [5, 10, 20, 20]), ('num_frames', 14), ('_class_name', 'UNetSpatioTemporalConditionModel'), ('_diffusers_version', '0.24.0.dev0'), ('_name_or_path', 'stabilityai/stable-video-diffusion-img2vid')])
layers per block is 2
FrozenDict([('sample_size', 96), ('in_channels', 8), ('out_channels', 4), ('down_block_types', ['CrossAttnDownBlockSpatioTemporal', 'CrossAttnDownBlockSpatioTemporal', 'CrossAttnDownBlockSpatioTemporal', 'DownBlockSpatioTemporal']), ('up_block_types', ['UpBlockSpatioTemporal', 'CrossAttnUpBlockSpatioTemporal', 'CrossAttnUpBlockSpatioTemporal', 'CrossAttnUpBlockSpatioTemporal']), ('block_out_channels', [320, 640, 1280, 1280]), ('addition_time_embed_dim', 256), ('projection_class_embeddings_input_dim', 768), ('layers_per_block', 2), ('cross_attention_dim', 1024), ('transformer_layers_per_block', 1), ('num_attention_heads', [5, 10, 20, 20]), ('num_frames', 14), ('_class_name', 'UNetSpatioTemporalConditionModel'), ('_diffusers_version', '0.24.0.dev0'), ('_name_or_path', 'stabilityai/stable-video-diffusion-img2vid')])
layers per block is 2
1
1
1
1
data scale: 5910
length 5910
sample size (512, 512)
/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/torch/utils/data/dataloader.py:557: UserWarning: This DataLoader will create 8 worker processes in total. Our suggested max number of worker in current system is 4, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
data scale: 5910
data scale: 5910
length 5910
sample size (512, 512)
length 5910
sample size (512, 512)
/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/torch/utils/data/dataloader.py:557: UserWarning: This DataLoader will create 8 worker processes in total. Our suggested max number of worker in current system is 4, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/torch/utils/data/dataloader.py:557: UserWarning: This DataLoader will create 8 worker processes in total. Our suggested max number of worker in current system is 4, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
data scale: 5910
length 5910
sample size (512, 512)
/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/torch/utils/data/dataloader.py:557: UserWarning: This DataLoader will create 8 worker processes in total. Our suggested max number of worker in current system is 4, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(_create_warning_msg(
Using /fs/nexus-scratch/sjxu/.cache/torch_extensions/py39_cu121 as PyTorch extensions root...
Using /fs/nexus-scratch/sjxu/.cache/torch_extensions/py39_cu121 as PyTorch extensions root...
Using /fs/nexus-scratch/sjxu/.cache/torch_extensions/py39_cu121 as PyTorch extensions root...
Using /fs/nexus-scratch/sjxu/.cache/torch_extensions/py39_cu121 as PyTorch extensions root...
Emitting ninja build file /fs/nexus-scratch/sjxu/.cache/torch_extensions/py39_cu121/cpu_adam/build.ninja...
Building extension module cpu_adam...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
[1/3] c++ -MMD -MF cpu_adam.o.d -DTORCH_EXTENSION_NAME=cpu_adam -DTORCH_API_INCLUDE_EXTENSION_H -DPYBIND11_COMPILER_TYPE=\"_gcc\" -DPYBIND11_STDLIB=\"_libstdcpp\" -DPYBIND11_BUILD_ABI=\"_cxxabi1011\" -I/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/deepspeed/ops/csrc/includes -isystem /fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/torch/include -isystem /fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/torch/include/torch/csrc/api/include -isystem /fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/torch/include/TH -isystem /fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/torch/include/THC -isystem /fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/include/python3.9 -D_GLIBCXX_USE_CXX11_ABI=0 -fPIC -std=c++17 -O3 -std=c++17 -g -Wno-reorder -L/opt/common/cuda/cuda-12.1.1/lib64 -lcudart -lcublas -g -march=native -fopenmp -D__AVX256__ -D__ENABLE_CUDA__ -DBF16_AVAILABLE -c /fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/deepspeed/ops/csrc/adam/cpu_adam.cpp -o cpu_adam.o 
[2/3] c++ -MMD -MF cpu_adam_impl.o.d -DTORCH_EXTENSION_NAME=cpu_adam -DTORCH_API_INCLUDE_EXTENSION_H -DPYBIND11_COMPILER_TYPE=\"_gcc\" -DPYBIND11_STDLIB=\"_libstdcpp\" -DPYBIND11_BUILD_ABI=\"_cxxabi1011\" -I/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/deepspeed/ops/csrc/includes -isystem /fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/torch/include -isystem /fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/torch/include/torch/csrc/api/include -isystem /fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/torch/include/TH -isystem /fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/torch/include/THC -isystem /fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/include/python3.9 -D_GLIBCXX_USE_CXX11_ABI=0 -fPIC -std=c++17 -O3 -std=c++17 -g -Wno-reorder -L/opt/common/cuda/cuda-12.1.1/lib64 -lcudart -lcublas -g -march=native -fopenmp -D__AVX256__ -D__ENABLE_CUDA__ -DBF16_AVAILABLE -c /fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/deepspeed/ops/csrc/adam/cpu_adam_impl.cpp -o cpu_adam_impl.o 
[3/3] c++ cpu_adam.o cpu_adam_impl.o -shared -lcurand -L/opt/common/cuda/cuda-12.1.1/lib64 -L/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/torch/lib -lc10 -ltorch_cpu -ltorch -ltorch_python -o cpu_adam.so
Loading extension module cpu_adam...
Time to load cpu_adam op: 33.955464124679565 seconds
Adam Optimizer #0 is created with AVX2 arithmetic capability.
Config: alpha=0.000100, betas=(0.900000, 0.999000), weight_decay=0.010000, adam_w=1
[2024-11-29 17:05:57,243] [INFO] [config.py:733:__init__] Config mesh_device None world_size = 4
Loading extension module cpu_adam...
Time to load cpu_adam op: 33.97419881820679 seconds
Adam Optimizer #0 is created with AVX2 arithmetic capability.
Config: alpha=0.000100, betas=(0.900000, 0.999000), weight_decay=0.010000, adam_w=1
[2024-11-29 17:05:57,263] [INFO] [config.py:733:__init__] Config mesh_device None world_size = 4
Loading extension module cpu_adam...
Time to load cpu_adam op: 33.98827624320984 seconds
Adam Optimizer #0 is created with AVX2 arithmetic capability.
Config: alpha=0.000100, betas=(0.900000, 0.999000), weight_decay=0.010000, adam_w=1
[2024-11-29 17:05:57,272] [INFO] [config.py:733:__init__] Config mesh_device None world_size = 4
Loading extension module cpu_adam...
Time to load cpu_adam op: 33.91713309288025 seconds
Adam Optimizer #0 is created with AVX2 arithmetic capability.
Config: alpha=0.000100, betas=(0.900000, 0.999000), weight_decay=0.010000, adam_w=1
[2024-11-29 17:05:57,335] [INFO] [logging.py:128:log_dist] [Rank 0] DeepSpeed info: version=0.15.4, git-hash=unknown, git-branch=unknown
[2024-11-29 17:05:57,335] [INFO] [config.py:733:__init__] Config mesh_device None world_size = 4
gammagpu17:1752320:1752320 [0] NCCL INFO Bootstrap : Using bond0:192.168.44.28<0>
gammagpu17:1752320:1752320 [0] NCCL INFO NET/Plugin : dlerror=libnccl-net.so: cannot open shared object file: No such file or directory No plugin found (libnccl-net.so), using internal implementation
gammagpu17:1752320:1752320 [0] NCCL INFO cudaDriverVersion 12040
NCCL version 2.20.5+cuda12.4
gammagpu17:1752328:1752328 [3] NCCL INFO cudaDriverVersion 12040
gammagpu17:1752323:1752323 [2] NCCL INFO cudaDriverVersion 12040
gammagpu17:1752321:1752321 [1] NCCL INFO cudaDriverVersion 12040
gammagpu17:1752328:1752328 [3] NCCL INFO Bootstrap : Using bond0:192.168.44.28<0>
gammagpu17:1752328:1752328 [3] NCCL INFO NET/Plugin : dlerror=libnccl-net.so: cannot open shared object file: No such file or directory No plugin found (libnccl-net.so), using internal implementation
gammagpu17:1752323:1752323 [2] NCCL INFO Bootstrap : Using bond0:192.168.44.28<0>
gammagpu17:1752321:1752321 [1] NCCL INFO Bootstrap : Using bond0:192.168.44.28<0>
gammagpu17:1752323:1752323 [2] NCCL INFO NET/Plugin : dlerror=libnccl-net.so: cannot open shared object file: No such file or directory No plugin found (libnccl-net.so), using internal implementation
gammagpu17:1752321:1752321 [1] NCCL INFO NET/Plugin : dlerror=libnccl-net.so: cannot open shared object file: No such file or directory No plugin found (libnccl-net.so), using internal implementation
gammagpu17:1752321:1752683 [1] NCCL INFO NCCL_IB_DISABLE set by environment to 1.
gammagpu17:1752320:1752681 [0] NCCL INFO NCCL_IB_DISABLE set by environment to 1.
gammagpu17:1752323:1752684 [2] NCCL INFO NCCL_IB_DISABLE set by environment to 1.
gammagpu17:1752320:1752681 [0] NCCL INFO NET/Socket : Using [0]bond0:192.168.44.28<0> [1]virbr0:192.168.122.1<0> [2]enp67s0f3u2u3c2:fe80::401c:2eff:fedd:e48a%enp67s0f3u2u3c2<0>
gammagpu17:1752321:1752683 [1] NCCL INFO NET/Socket : Using [0]bond0:192.168.44.28<0> [1]virbr0:192.168.122.1<0> [2]enp67s0f3u2u3c2:fe80::401c:2eff:fedd:e48a%enp67s0f3u2u3c2<0>
gammagpu17:1752320:1752681 [0] NCCL INFO Using non-device net plugin version 0
gammagpu17:1752321:1752683 [1] NCCL INFO Using non-device net plugin version 0
gammagpu17:1752320:1752681 [0] NCCL INFO Using network Socket
gammagpu17:1752321:1752683 [1] NCCL INFO Using network Socket
gammagpu17:1752323:1752684 [2] NCCL INFO NET/Socket : Using [0]bond0:192.168.44.28<0> [1]virbr0:192.168.122.1<0> [2]enp67s0f3u2u3c2:fe80::401c:2eff:fedd:e48a%enp67s0f3u2u3c2<0>
gammagpu17:1752323:1752684 [2] NCCL INFO Using non-device net plugin version 0
gammagpu17:1752323:1752684 [2] NCCL INFO Using network Socket
gammagpu17:1752328:1752682 [3] NCCL INFO NCCL_IB_DISABLE set by environment to 1.
gammagpu17:1752328:1752682 [3] NCCL INFO NET/Socket : Using [0]bond0:192.168.44.28<0> [1]virbr0:192.168.122.1<0> [2]enp67s0f3u2u3c2:fe80::401c:2eff:fedd:e48a%enp67s0f3u2u3c2<0>
gammagpu17:1752328:1752682 [3] NCCL INFO Using non-device net plugin version 0
gammagpu17:1752328:1752682 [3] NCCL INFO Using network Socket
gammagpu17:1752323:1752684 [2] NCCL INFO comm 0x5627a187e0c0 rank 2 nranks 4 cudaDev 2 nvmlDev 2 busId 81000 commId 0x4d52204f321a62bd - Init START
gammagpu17:1752320:1752681 [0] NCCL INFO comm 0x55da5a93ab00 rank 0 nranks 4 cudaDev 0 nvmlDev 0 busId 1000 commId 0x4d52204f321a62bd - Init START
gammagpu17:1752328:1752682 [3] NCCL INFO comm 0x557dc4280600 rank 3 nranks 4 cudaDev 3 nvmlDev 3 busId c1000 commId 0x4d52204f321a62bd - Init START
gammagpu17:1752321:1752683 [1] NCCL INFO comm 0x55f701939a40 rank 1 nranks 4 cudaDev 1 nvmlDev 1 busId 41000 commId 0x4d52204f321a62bd - Init START
gammagpu17:1752323:1752684 [2] NCCL INFO NVLS multicast support is not available on dev 2
gammagpu17:1752328:1752682 [3] NCCL INFO NVLS multicast support is not available on dev 3
gammagpu17:1752320:1752681 [0] NCCL INFO NVLS multicast support is not available on dev 0
gammagpu17:1752321:1752683 [1] NCCL INFO NVLS multicast support is not available on dev 1
gammagpu17:1752320:1752681 [0] NCCL INFO comm 0x55da5a93ab00 rank 0 nRanks 4 nNodes 1 localRanks 4 localRank 0 MNNVL 0
gammagpu17:1752320:1752681 [0] NCCL INFO Channel 00/04 :    0   1   2   3
gammagpu17:1752320:1752681 [0] NCCL INFO Channel 01/04 :    0   1   2   3
gammagpu17:1752328:1752682 [3] NCCL INFO comm 0x557dc4280600 rank 3 nRanks 4 nNodes 1 localRanks 4 localRank 3 MNNVL 0
gammagpu17:1752321:1752683 [1] NCCL INFO comm 0x55f701939a40 rank 1 nRanks 4 nNodes 1 localRanks 4 localRank 1 MNNVL 0
gammagpu17:1752320:1752681 [0] NCCL INFO Channel 02/04 :    0   1   2   3
gammagpu17:1752320:1752681 [0] NCCL INFO Channel 03/04 :    0   1   2   3
gammagpu17:1752323:1752684 [2] NCCL INFO comm 0x5627a187e0c0 rank 2 nRanks 4 nNodes 1 localRanks 4 localRank 2 MNNVL 0
gammagpu17:1752320:1752681 [0] NCCL INFO Trees [0] 1/-1/-1->0->-1 [1] 1/-1/-1->0->-1 [2] 1/-1/-1->0->-1 [3] 1/-1/-1->0->-1
gammagpu17:1752320:1752681 [0] NCCL INFO P2P Chunksize set to 131072
gammagpu17:1752328:1752682 [3] NCCL INFO Trees [0] -1/-1/-1->3->2 [1] -1/-1/-1->3->2 [2] -1/-1/-1->3->2 [3] -1/-1/-1->3->2
gammagpu17:1752321:1752683 [1] NCCL INFO Trees [0] 2/-1/-1->1->0 [1] 2/-1/-1->1->0 [2] 2/-1/-1->1->0 [3] 2/-1/-1->1->0
gammagpu17:1752328:1752682 [3] NCCL INFO P2P Chunksize set to 131072
gammagpu17:1752321:1752683 [1] NCCL INFO P2P Chunksize set to 131072
gammagpu17:1752323:1752684 [2] NCCL INFO Trees [0] 3/-1/-1->2->1 [1] 3/-1/-1->2->1 [2] 3/-1/-1->2->1 [3] 3/-1/-1->2->1
gammagpu17:1752323:1752684 [2] NCCL INFO P2P Chunksize set to 131072
gammagpu17:1752328:1752682 [3] NCCL INFO Channel 00/0 : 3[3] -> 0[0] via P2P/CUMEM
gammagpu17:1752328:1752682 [3] NCCL INFO Channel 01/0 : 3[3] -> 0[0] via P2P/CUMEM
gammagpu17:1752328:1752682 [3] NCCL INFO Channel 02/0 : 3[3] -> 0[0] via P2P/CUMEM
gammagpu17:1752328:1752682 [3] NCCL INFO Channel 03/0 : 3[3] -> 0[0] via P2P/CUMEM
gammagpu17:1752320:1752681 [0] NCCL INFO Channel 00/0 : 0[0] -> 1[1] via P2P/CUMEM
gammagpu17:1752321:1752683 [1] NCCL INFO Channel 00/0 : 1[1] -> 2[2] via P2P/CUMEM
gammagpu17:1752323:1752684 [2] NCCL INFO Channel 00/0 : 2[2] -> 3[3] via P2P/CUMEM
gammagpu17:1752320:1752681 [0] NCCL INFO Channel 01/0 : 0[0] -> 1[1] via P2P/CUMEM
gammagpu17:1752321:1752683 [1] NCCL INFO Channel 01/0 : 1[1] -> 2[2] via P2P/CUMEM
gammagpu17:1752323:1752684 [2] NCCL INFO Channel 01/0 : 2[2] -> 3[3] via P2P/CUMEM
gammagpu17:1752321:1752683 [1] NCCL INFO Channel 02/0 : 1[1] -> 2[2] via P2P/CUMEM
gammagpu17:1752320:1752681 [0] NCCL INFO Channel 02/0 : 0[0] -> 1[1] via P2P/CUMEM
gammagpu17:1752323:1752684 [2] NCCL INFO Channel 02/0 : 2[2] -> 3[3] via P2P/CUMEM
gammagpu17:1752321:1752683 [1] NCCL INFO Channel 03/0 : 1[1] -> 2[2] via P2P/CUMEM
gammagpu17:1752323:1752684 [2] NCCL INFO Channel 03/0 : 2[2] -> 3[3] via P2P/CUMEM
gammagpu17:1752320:1752681 [0] NCCL INFO Channel 03/0 : 0[0] -> 1[1] via P2P/CUMEM
gammagpu17:1752328:1752682 [3] NCCL INFO Connected all rings
gammagpu17:1752328:1752682 [3] NCCL INFO Channel 00/0 : 3[3] -> 2[2] via P2P/CUMEM
gammagpu17:1752323:1752684 [2] NCCL INFO Connected all rings
gammagpu17:1752320:1752681 [0] NCCL INFO Connected all rings
gammagpu17:1752321:1752683 [1] NCCL INFO Connected all rings
gammagpu17:1752328:1752682 [3] NCCL INFO Channel 01/0 : 3[3] -> 2[2] via P2P/CUMEM
gammagpu17:1752328:1752682 [3] NCCL INFO Channel 02/0 : 3[3] -> 2[2] via P2P/CUMEM
gammagpu17:1752328:1752682 [3] NCCL INFO Channel 03/0 : 3[3] -> 2[2] via P2P/CUMEM
gammagpu17:1752321:1752683 [1] NCCL INFO Channel 00/0 : 1[1] -> 0[0] via P2P/CUMEM
gammagpu17:1752323:1752684 [2] NCCL INFO Channel 00/0 : 2[2] -> 1[1] via P2P/CUMEM
gammagpu17:1752321:1752683 [1] NCCL INFO Channel 01/0 : 1[1] -> 0[0] via P2P/CUMEM
gammagpu17:1752323:1752684 [2] NCCL INFO Channel 01/0 : 2[2] -> 1[1] via P2P/CUMEM
gammagpu17:1752321:1752683 [1] NCCL INFO Channel 02/0 : 1[1] -> 0[0] via P2P/CUMEM
gammagpu17:1752321:1752683 [1] NCCL INFO Channel 03/0 : 1[1] -> 0[0] via P2P/CUMEM
gammagpu17:1752323:1752684 [2] NCCL INFO Channel 02/0 : 2[2] -> 1[1] via P2P/CUMEM
gammagpu17:1752323:1752684 [2] NCCL INFO Channel 03/0 : 2[2] -> 1[1] via P2P/CUMEM
gammagpu17:1752328:1752682 [3] NCCL INFO Connected all trees
gammagpu17:1752328:1752682 [3] NCCL INFO threadThresholds 8/8/64 | 32/8/64 | 512 | 512
gammagpu17:1752328:1752682 [3] NCCL INFO 4 coll channels, 0 collnet channels, 0 nvls channels, 4 p2p channels, 2 p2p channels per peer
gammagpu17:1752320:1752681 [0] NCCL INFO Connected all trees
gammagpu17:1752320:1752681 [0] NCCL INFO threadThresholds 8/8/64 | 32/8/64 | 512 | 512
gammagpu17:1752320:1752681 [0] NCCL INFO 4 coll channels, 0 collnet channels, 0 nvls channels, 4 p2p channels, 2 p2p channels per peer
gammagpu17:1752323:1752684 [2] NCCL INFO Connected all trees
gammagpu17:1752323:1752684 [2] NCCL INFO threadThresholds 8/8/64 | 32/8/64 | 512 | 512
gammagpu17:1752323:1752684 [2] NCCL INFO 4 coll channels, 0 collnet channels, 0 nvls channels, 4 p2p channels, 2 p2p channels per peer
gammagpu17:1752321:1752683 [1] NCCL INFO Connected all trees
gammagpu17:1752321:1752683 [1] NCCL INFO threadThresholds 8/8/64 | 32/8/64 | 512 | 512
gammagpu17:1752321:1752683 [1] NCCL INFO 4 coll channels, 0 collnet channels, 0 nvls channels, 4 p2p channels, 2 p2p channels per peer
gammagpu17:1752320:1752681 [0] NCCL INFO comm 0x55da5a93ab00 rank 0 nranks 4 cudaDev 0 nvmlDev 0 busId 1000 commId 0x4d52204f321a62bd - Init COMPLETE
gammagpu17:1752323:1752684 [2] NCCL INFO comm 0x5627a187e0c0 rank 2 nranks 4 cudaDev 2 nvmlDev 2 busId 81000 commId 0x4d52204f321a62bd - Init COMPLETE
gammagpu17:1752328:1752682 [3] NCCL INFO comm 0x557dc4280600 rank 3 nranks 4 cudaDev 3 nvmlDev 3 busId c1000 commId 0x4d52204f321a62bd - Init COMPLETE
gammagpu17:1752321:1752683 [1] NCCL INFO comm 0x55f701939a40 rank 1 nranks 4 cudaDev 1 nvmlDev 1 busId 41000 commId 0x4d52204f321a62bd - Init COMPLETE
[2024-11-29 17:05:58,323] [INFO] [logging.py:128:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2024-11-29 17:05:58,326] [INFO] [logging.py:128:log_dist] [Rank 0] Using client Optimizer as basic optimizer
[2024-11-29 17:05:58,326] [INFO] [logging.py:128:log_dist] [Rank 0] Removing param_group that has no 'params' in the basic Optimizer
[2024-11-29 17:05:58,378] [INFO] [logging.py:128:log_dist] [Rank 0] DeepSpeed Basic Optimizer = DeepSpeedCPUAdam
[2024-11-29 17:05:58,378] [INFO] [utils.py:59:is_zero_supported_optimizer] Checking ZeRO support for optimizer=DeepSpeedCPUAdam type=<class 'deepspeed.ops.adam.cpu_adam.DeepSpeedCPUAdam'>
[2024-11-29 17:05:58,378] [INFO] [logging.py:128:log_dist] [Rank 0] Creating torch.float16 ZeRO stage 2 optimizer
[2024-11-29 17:05:58,378] [INFO] [stage_1_and_2.py:149:__init__] Reduce bucket size 500000000
[2024-11-29 17:05:58,378] [INFO] [stage_1_and_2.py:150:__init__] Allgather bucket size 500000000
[2024-11-29 17:05:58,378] [INFO] [stage_1_and_2.py:151:__init__] CPU Offload: True
[2024-11-29 17:05:58,378] [INFO] [stage_1_and_2.py:152:__init__] Round robin gradient partitioning: False
[2024-11-29 17:06:00,787] [INFO] [utils.py:781:see_memory_usage] Before initializing optimizer states
[2024-11-29 17:06:00,788] [INFO] [utils.py:782:see_memory_usage] MA 7.46 GB         Max_MA 7.46 GB         CA 7.64 GB         Max_CA 8 GB 
[2024-11-29 17:06:00,788] [INFO] [utils.py:789:see_memory_usage] CPU Virtual Memory:  used = 33.27 GB, percent = 26.6%
[2024-11-29 17:06:01,528] [INFO] [utils.py:781:see_memory_usage] After initializing optimizer states
[2024-11-29 17:06:01,529] [INFO] [utils.py:782:see_memory_usage] MA 7.46 GB         Max_MA 7.46 GB         CA 7.64 GB         Max_CA 8 GB 
[2024-11-29 17:06:01,529] [INFO] [utils.py:789:see_memory_usage] CPU Virtual Memory:  used = 34.57 GB, percent = 27.6%
[2024-11-29 17:06:01,529] [INFO] [stage_1_and_2.py:544:__init__] optimizer state initialized
Traceback (most recent call last):
  File "/fs/nexus-scratch/sjxu/svd-temporal-controlnet/train_svd_con.py", line 1911, in <module>
    main()
  File "/fs/nexus-scratch/sjxu/svd-temporal-controlnet/train_svd_con.py", line 1178, in main
    controlnet, optimizer, lr_scheduler, train_dataloader = accelerator.prepare(
  File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/accelerate/accelerator.py", line 1323, in prepare
    result = self._prepare_deepspeed(*args)
  File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/accelerate/accelerator.py", line 1842, in _prepare_deepspeed
    engine, optimizer, _, lr_scheduler = ds_initialize(**kwargs)
  File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/deepspeed/__init__.py", line 193, in initialize
    engine = DeepSpeedEngine(args=args,
  File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/deepspeed/runtime/engine.py", line 313, in __init__
    self._configure_optimizer(optimizer, model_parameters)
  File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/deepspeed/runtime/engine.py", line 1302, in _configure_optimizer
    self.optimizer = self._configure_zero_optimizer(basic_optimizer)
  File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/deepspeed/runtime/engine.py", line 1560, in _configure_zero_optimizer
    optimizer = DeepSpeedZeroOptimizer(
  File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/deepspeed/runtime/zero/stage_1_and_2.py", line 553, in __init__
    self._param_slice_mappings = self._create_param_mapping()
  File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/deepspeed/runtime/zero/stage_1_and_2.py", line 574, in _create_param_mapping
    lp_name = self.param_names[lp]
KeyError: Parameter containing:
tensor([[-1.6308e-03,  3.0470e-04,  3.6602e-03,  ..., -8.2169e-03,
         -3.2368e-03, -1.7044e-02],
        [ 1.2674e-03, -2.1839e-04,  3.1166e-03,  ...,  1.4095e-03,
          3.6278e-03, -2.5826e-03],
        [ 2.9125e-03, -3.8242e-03,  1.7881e-07,  ..., -4.5586e-03,
          4.8180e-03,  3.9787e-03],
        ...,
        [-9.3603e-04,  2.5940e-03,  5.3368e-03,  ...,  6.3610e-04,
          3.2306e-04, -1.2493e-03],
        [-1.1673e-03,  3.0632e-03, -1.5793e-03,  ..., -3.9635e-03,
         -2.2087e-03,  3.5095e-03],
        [-1.5039e-03, -2.9602e-03,  4.2114e-03,  ..., -3.6659e-03,
          2.3556e-03,  2.1057e-03]], device='cuda:3', requires_grad=True)
Traceback (most recent call last):
  File "/fs/nexus-scratch/sjxu/svd-temporal-controlnet/train_svd_con.py", line 1911, in <module>
    main()
  File "/fs/nexus-scratch/sjxu/svd-temporal-controlnet/train_svd_con.py", line 1178, in main
    controlnet, optimizer, lr_scheduler, train_dataloader = accelerator.prepare(
  File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/accelerate/accelerator.py", line 1323, in prepare
    result = self._prepare_deepspeed(*args)
  File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/accelerate/accelerator.py", line 1842, in _prepare_deepspeed
    engine, optimizer, _, lr_scheduler = ds_initialize(**kwargs)
  File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/deepspeed/__init__.py", line 193, in initialize
    engine = DeepSpeedEngine(args=args,
  File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/deepspeed/runtime/engine.py", line 313, in __init__
    self._configure_optimizer(optimizer, model_parameters)
  File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/deepspeed/runtime/engine.py", line 1302, in _configure_optimizer
    self.optimizer = self._configure_zero_optimizer(basic_optimizer)
  File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/deepspeed/runtime/engine.py", line 1560, in _configure_zero_optimizer
    optimizer = DeepSpeedZeroOptimizer(
  File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/deepspeed/runtime/zero/stage_1_and_2.py", line 553, in __init__
    self._param_slice_mappings = self._create_param_mapping()
  File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/deepspeed/runtime/zero/stage_1_and_2.py", line 574, in _create_param_mapping
    lp_name = self.param_names[lp]
KeyError: Parameter containing:
tensor([[-0.0472,  0.0085, -0.0054,  ...,  0.0085, -0.0339, -0.0247],
        [-0.0597,  0.0274,  0.0456,  ..., -0.0003, -0.0093, -0.0056],
        [ 0.0244, -0.0083, -0.0019,  ..., -0.0127,  0.0043,  0.0470],
        ...,
        [ 0.0257, -0.0746,  0.0192,  ...,  0.0361, -0.0050,  0.0175],
        [ 0.0560,  0.0043,  0.0165,  ..., -0.0195, -0.0163, -0.0806],
        [ 0.0413, -0.0277,  0.0331,  ..., -0.0024, -0.0371, -0.0586]],
       device='cuda:1', requires_grad=True)
Traceback (most recent call last):
  File "/fs/nexus-scratch/sjxu/svd-temporal-controlnet/train_svd_con.py", line 1911, in <module>
    main()
  File "/fs/nexus-scratch/sjxu/svd-temporal-controlnet/train_svd_con.py", line 1178, in main
    controlnet, optimizer, lr_scheduler, train_dataloader = accelerator.prepare(
  File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/accelerate/accelerator.py", line 1323, in prepare
    result = self._prepare_deepspeed(*args)
  File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/accelerate/accelerator.py", line 1842, in _prepare_deepspeed
    engine, optimizer, _, lr_scheduler = ds_initialize(**kwargs)
  File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/deepspeed/__init__.py", line 193, in initialize
    engine = DeepSpeedEngine(args=args,
  File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/deepspeed/runtime/engine.py", line 313, in __init__
    self._configure_optimizer(optimizer, model_parameters)
  File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/deepspeed/runtime/engine.py", line 1302, in _configure_optimizer
    self.optimizer = self._configure_zero_optimizer(basic_optimizer)
  File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/deepspeed/runtime/engine.py", line 1560, in _configure_zero_optimizer
    optimizer = DeepSpeedZeroOptimizer(
  File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/deepspeed/runtime/zero/stage_1_and_2.py", line 553, in __init__
    self._param_slice_mappings = self._create_param_mapping()
  File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/deepspeed/runtime/zero/stage_1_and_2.py", line 574, in _create_param_mapping
    lp_name = self.param_names[lp]
KeyError: Parameter containing:
tensor([[[[[ 0.0017]],

          [[-0.0208]],

          [[ 0.0352]]],


         [[[ 0.0028]],

          [[-0.0216]],

          [[-0.0444]]],


         [[[ 0.0045]],

          [[ 0.0087]],

          [[-0.0025]]],


         ...,


         [[[ 0.0202]],

          [[ 0.0493]],

          [[ 0.0069]]],


         [[[ 0.0030]],

          [[-0.0085]],

          [[-0.0007]]],


         [[[ 0.0187]],

          [[ 0.0081]],

          [[ 0.0515]]]],



        [[[[ 0.0095]],

          [[-0.0015]],

          [[-0.0150]]],


         [[[ 0.0569]],

          [[-0.0164]],

          [[ 0.0124]]],


         [[[-0.0070]],

          [[-0.0048]],

          [[ 0.0025]]],


         ...,


         [[[-0.0319]],

          [[-0.0230]],

          [[ 0.0015]]],


         [[[-0.0131]],

          [[-0.0239]],

          [[-0.0438]]],


         [[[-0.0143]],

          [[-0.0051]],

          [[-0.0328]]]],



        [[[[-0.0105]],

          [[-0.0094]],

          [[ 0.0066]]],


         [[[-0.0883]],

          [[-0.0463]],

          [[-0.0242]]],


         [[[-0.0085]],

          [[ 0.0041]],

          [[-0.0029]]],


         ...,


         [[[ 0.0103]],

          [[-0.0089]],

          [[ 0.0121]]],


         [[[-0.0024]],

          [[-0.0077]],

          [[ 0.0053]]],


         [[[ 0.0091]],

          [[-0.0059]],

          [[ 0.0066]]]],



        ...,



        [[[[ 0.0434]],

          [[ 0.0101]],

          [[-0.0138]]],


         [[[-0.0410]],

          [[ 0.0211]],

          [[ 0.0732]]],


         [[[-0.0123]],

          [[ 0.0410]],

          [[-0.0134]]],


         ...,


         [[[-0.0019]],

          [[ 0.0028]],

          [[ 0.0080]]],


         [[[-0.0038]],

          [[-0.0125]],

          [[-0.0171]]],


         [[[ 0.0097]],

          [[ 0.0237]],

          [[ 0.0285]]]],



        [[[[-0.0277]],

          [[ 0.0271]],

          [[-0.0169]]],


         [[[ 0.0266]],

          [[-0.0091]],

          [[-0.0034]]],


         [[[-0.0408]],

          [[ 0.0236]],

          [[-0.0199]]],


         ...,


         [[[-0.0230]],

          [[-0.0157]],

          [[-0.0075]]],


         [[[-0.0114]],

          [[-0.0278]],

          [[-0.0280]]],


         [[[-0.0041]],

          [[-0.0056]],

          [[-0.0181]]]],



        [[[[ 0.0127]],

          [[-0.0053]],

          [[ 0.0058]]],


         [[[-0.0254]],

          [[-0.0034]],

          [[ 0.0230]]],


         [[[-0.0082]],

          [[-0.0053]],

          [[-0.0278]]],


         ...,


         [[[ 0.0034]],

          [[-0.0043]],

          [[-0.0197]]],


         [[[-0.0163]],

          [[-0.0493]],

          [[-0.0399]]],


         [[[ 0.0275]],

          [[ 0.0547]],

          [[ 0.0296]]]]], device='cuda:2', requires_grad=True)
[rank1]: Traceback (most recent call last):
[rank1]:   File "/fs/nexus-scratch/sjxu/svd-temporal-controlnet/train_svd_con.py", line 1911, in <module>
[rank1]:     main()
[rank1]:   File "/fs/nexus-scratch/sjxu/svd-temporal-controlnet/train_svd_con.py", line 1178, in main
[rank1]:     controlnet, optimizer, lr_scheduler, train_dataloader = accelerator.prepare(
[rank1]:   File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/accelerate/accelerator.py", line 1323, in prepare
[rank1]:     result = self._prepare_deepspeed(*args)
[rank1]:   File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/accelerate/accelerator.py", line 1842, in _prepare_deepspeed
[rank1]:     engine, optimizer, _, lr_scheduler = ds_initialize(**kwargs)
[rank1]:   File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/deepspeed/__init__.py", line 193, in initialize
[rank1]:     engine = DeepSpeedEngine(args=args,
[rank1]:   File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/deepspeed/runtime/engine.py", line 313, in __init__
[rank1]:     self._configure_optimizer(optimizer, model_parameters)
[rank1]:   File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/deepspeed/runtime/engine.py", line 1302, in _configure_optimizer
[rank1]:     self.optimizer = self._configure_zero_optimizer(basic_optimizer)
[rank1]:   File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/deepspeed/runtime/engine.py", line 1560, in _configure_zero_optimizer
[rank1]:     optimizer = DeepSpeedZeroOptimizer(
[rank1]:   File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/deepspeed/runtime/zero/stage_1_and_2.py", line 553, in __init__
[rank1]:     self._param_slice_mappings = self._create_param_mapping()
[rank1]:   File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/deepspeed/runtime/zero/stage_1_and_2.py", line 574, in _create_param_mapping
[rank1]:     lp_name = self.param_names[lp]
[rank1]: KeyError: Parameter containing:
[rank1]: tensor([[-0.0472,  0.0085, -0.0054,  ...,  0.0085, -0.0339, -0.0247],
[rank1]:         [-0.0597,  0.0274,  0.0456,  ..., -0.0003, -0.0093, -0.0056],
[rank1]:         [ 0.0244, -0.0083, -0.0019,  ..., -0.0127,  0.0043,  0.0470],
[rank1]:         ...,
[rank1]:         [ 0.0257, -0.0746,  0.0192,  ...,  0.0361, -0.0050,  0.0175],
[rank1]:         [ 0.0560,  0.0043,  0.0165,  ..., -0.0195, -0.0163, -0.0806],
[rank1]:         [ 0.0413, -0.0277,  0.0331,  ..., -0.0024, -0.0371, -0.0586]],
[rank1]:        device='cuda:1', requires_grad=True)
[rank3]: Traceback (most recent call last):
[rank3]:   File "/fs/nexus-scratch/sjxu/svd-temporal-controlnet/train_svd_con.py", line 1911, in <module>
[rank3]:     main()
[rank3]:   File "/fs/nexus-scratch/sjxu/svd-temporal-controlnet/train_svd_con.py", line 1178, in main
[rank3]:     controlnet, optimizer, lr_scheduler, train_dataloader = accelerator.prepare(
[rank3]:   File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/accelerate/accelerator.py", line 1323, in prepare
[rank3]:     result = self._prepare_deepspeed(*args)
[rank3]:   File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/accelerate/accelerator.py", line 1842, in _prepare_deepspeed
[rank3]:     engine, optimizer, _, lr_scheduler = ds_initialize(**kwargs)
[rank3]:   File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/deepspeed/__init__.py", line 193, in initialize
[rank3]:     engine = DeepSpeedEngine(args=args,
[rank3]:   File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/deepspeed/runtime/engine.py", line 313, in __init__
[rank3]:     self._configure_optimizer(optimizer, model_parameters)
[rank3]:   File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/deepspeed/runtime/engine.py", line 1302, in _configure_optimizer
[rank3]:     self.optimizer = self._configure_zero_optimizer(basic_optimizer)
[rank3]:   File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/deepspeed/runtime/engine.py", line 1560, in _configure_zero_optimizer
[rank3]:     optimizer = DeepSpeedZeroOptimizer(
[rank3]:   File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/deepspeed/runtime/zero/stage_1_and_2.py", line 553, in __init__
[rank3]:     self._param_slice_mappings = self._create_param_mapping()
[rank3]:   File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/deepspeed/runtime/zero/stage_1_and_2.py", line 574, in _create_param_mapping
[rank3]:     lp_name = self.param_names[lp]
[rank3]: KeyError: Parameter containing:
[rank3]: tensor([[-1.6308e-03,  3.0470e-04,  3.6602e-03,  ..., -8.2169e-03,
[rank3]:          -3.2368e-03, -1.7044e-02],
[rank3]:         [ 1.2674e-03, -2.1839e-04,  3.1166e-03,  ...,  1.4095e-03,
[rank3]:           3.6278e-03, -2.5826e-03],
[rank3]:         [ 2.9125e-03, -3.8242e-03,  1.7881e-07,  ..., -4.5586e-03,
[rank3]:           4.8180e-03,  3.9787e-03],
[rank3]:         ...,
[rank3]:         [-9.3603e-04,  2.5940e-03,  5.3368e-03,  ...,  6.3610e-04,
[rank3]:           3.2306e-04, -1.2493e-03],
[rank3]:         [-1.1673e-03,  3.0632e-03, -1.5793e-03,  ..., -3.9635e-03,
[rank3]:          -2.2087e-03,  3.5095e-03],
[rank3]:         [-1.5039e-03, -2.9602e-03,  4.2114e-03,  ..., -3.6659e-03,
[rank3]:           2.3556e-03,  2.1057e-03]], device='cuda:3', requires_grad=True)
[rank2]: Traceback (most recent call last):
[rank2]:   File "/fs/nexus-scratch/sjxu/svd-temporal-controlnet/train_svd_con.py", line 1911, in <module>
[rank2]:     main()
[rank2]:   File "/fs/nexus-scratch/sjxu/svd-temporal-controlnet/train_svd_con.py", line 1178, in main
[rank2]:     controlnet, optimizer, lr_scheduler, train_dataloader = accelerator.prepare(
[rank2]:   File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/accelerate/accelerator.py", line 1323, in prepare
[rank2]:     result = self._prepare_deepspeed(*args)
[rank2]:   File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/accelerate/accelerator.py", line 1842, in _prepare_deepspeed
[rank2]:     engine, optimizer, _, lr_scheduler = ds_initialize(**kwargs)
[rank2]:   File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/deepspeed/__init__.py", line 193, in initialize
[rank2]:     engine = DeepSpeedEngine(args=args,
[rank2]:   File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/deepspeed/runtime/engine.py", line 313, in __init__
[rank2]:     self._configure_optimizer(optimizer, model_parameters)
[rank2]:   File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/deepspeed/runtime/engine.py", line 1302, in _configure_optimizer
[rank2]:     self.optimizer = self._configure_zero_optimizer(basic_optimizer)
[rank2]:   File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/deepspeed/runtime/engine.py", line 1560, in _configure_zero_optimizer
[rank2]:     optimizer = DeepSpeedZeroOptimizer(
[rank2]:   File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/deepspeed/runtime/zero/stage_1_and_2.py", line 553, in __init__
[rank2]:     self._param_slice_mappings = self._create_param_mapping()
[rank2]:   File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/deepspeed/runtime/zero/stage_1_and_2.py", line 574, in _create_param_mapping
[rank2]:     lp_name = self.param_names[lp]
[rank2]: KeyError: Parameter containing:
[rank2]: tensor([[[[[ 0.0017]],

[rank2]:           [[-0.0208]],

[rank2]:           [[ 0.0352]]],


[rank2]:          [[[ 0.0028]],

[rank2]:           [[-0.0216]],

[rank2]:           [[-0.0444]]],


[rank2]:          [[[ 0.0045]],

[rank2]:           [[ 0.0087]],

[rank2]:           [[-0.0025]]],


[rank2]:          ...,


[rank2]:          [[[ 0.0202]],

[rank2]:           [[ 0.0493]],

[rank2]:           [[ 0.0069]]],


[rank2]:          [[[ 0.0030]],

[rank2]:           [[-0.0085]],

[rank2]:           [[-0.0007]]],


[rank2]:          [[[ 0.0187]],

[rank2]:           [[ 0.0081]],

[rank2]:           [[ 0.0515]]]],



[rank2]:         [[[[ 0.0095]],

[rank2]:           [[-0.0015]],

[rank2]:           [[-0.0150]]],


[rank2]:          [[[ 0.0569]],

[rank2]:           [[-0.0164]],

[rank2]:           [[ 0.0124]]],


[rank2]:          [[[-0.0070]],

[rank2]:           [[-0.0048]],

[rank2]:           [[ 0.0025]]],


[rank2]:          ...,


[rank2]:          [[[-0.0319]],

[rank2]:           [[-0.0230]],

[rank2]:           [[ 0.0015]]],


[rank2]:          [[[-0.0131]],

[rank2]:           [[-0.0239]],

[rank2]:           [[-0.0438]]],


[rank2]:          [[[-0.0143]],

[rank2]:           [[-0.0051]],

[rank2]:           [[-0.0328]]]],



[rank2]:         [[[[-0.0105]],

[rank2]:           [[-0.0094]],

[rank2]:           [[ 0.0066]]],


[rank2]:          [[[-0.0883]],

[rank2]:           [[-0.0463]],

[rank2]:           [[-0.0242]]],


[rank2]:          [[[-0.0085]],

[rank2]:           [[ 0.0041]],

[rank2]:           [[-0.0029]]],


[rank2]:          ...,


[rank2]:          [[[ 0.0103]],

[rank2]:           [[-0.0089]],

[rank2]:           [[ 0.0121]]],


[rank2]:          [[[-0.0024]],

[rank2]:           [[-0.0077]],

[rank2]:           [[ 0.0053]]],


[rank2]:          [[[ 0.0091]],

[rank2]:           [[-0.0059]],

[rank2]:           [[ 0.0066]]]],



[rank2]:         ...,



[rank2]:         [[[[ 0.0434]],

[rank2]:           [[ 0.0101]],

[rank2]:           [[-0.0138]]],


[rank2]:          [[[-0.0410]],

[rank2]:           [[ 0.0211]],

[rank2]:           [[ 0.0732]]],


[rank2]:          [[[-0.0123]],

[rank2]:           [[ 0.0410]],

[rank2]:           [[-0.0134]]],


[rank2]:          ...,


[rank2]:          [[[-0.0019]],

[rank2]:           [[ 0.0028]],

[rank2]:           [[ 0.0080]]],


[rank2]:          [[[-0.0038]],

[rank2]:           [[-0.0125]],

[rank2]:           [[-0.0171]]],


[rank2]:          [[[ 0.0097]],

[rank2]:           [[ 0.0237]],

[rank2]:           [[ 0.0285]]]],



[rank2]:         [[[[-0.0277]],

[rank2]:           [[ 0.0271]],

[rank2]:           [[-0.0169]]],


[rank2]:          [[[ 0.0266]],

[rank2]:           [[-0.0091]],

[rank2]:           [[-0.0034]]],


[rank2]:          [[[-0.0408]],

[rank2]:           [[ 0.0236]],

[rank2]:           [[-0.0199]]],


[rank2]:          ...,


[rank2]:          [[[-0.0230]],

[rank2]:           [[-0.0157]],

[rank2]:           [[-0.0075]]],


[rank2]:          [[[-0.0114]],

[rank2]:           [[-0.0278]],

[rank2]:           [[-0.0280]]],


[rank2]:          [[[-0.0041]],

[rank2]:           [[-0.0056]],

[rank2]:           [[-0.0181]]]],



[rank2]:         [[[[ 0.0127]],

[rank2]:           [[-0.0053]],

[rank2]:           [[ 0.0058]]],


[rank2]:          [[[-0.0254]],

[rank2]:           [[-0.0034]],

[rank2]:           [[ 0.0230]]],


[rank2]:          [[[-0.0082]],

[rank2]:           [[-0.0053]],

[rank2]:           [[-0.0278]]],


[rank2]:          ...,


[rank2]:          [[[ 0.0034]],

[rank2]:           [[-0.0043]],

[rank2]:           [[-0.0197]]],


[rank2]:          [[[-0.0163]],

[rank2]:           [[-0.0493]],

[rank2]:           [[-0.0399]]],


[rank2]:          [[[ 0.0275]],

[rank2]:           [[ 0.0547]],

[rank2]:           [[ 0.0296]]]]], device='cuda:2', requires_grad=True)
[2024-11-29 17:06:01,690] [INFO] [utils.py:781:see_memory_usage] After initializing ZeRO optimizer
[2024-11-29 17:06:01,691] [INFO] [utils.py:782:see_memory_usage] MA 7.46 GB         Max_MA 7.46 GB         CA 7.64 GB         Max_CA 8 GB 
[2024-11-29 17:06:01,691] [INFO] [utils.py:789:see_memory_usage] CPU Virtual Memory:  used = 34.57 GB, percent = 27.6%
Traceback (most recent call last):
  File "/fs/nexus-scratch/sjxu/svd-temporal-controlnet/train_svd_con.py", line 1911, in <module>
    main()
  File "/fs/nexus-scratch/sjxu/svd-temporal-controlnet/train_svd_con.py", line 1178, in main
    controlnet, optimizer, lr_scheduler, train_dataloader = accelerator.prepare(
  File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/accelerate/accelerator.py", line 1323, in prepare
    result = self._prepare_deepspeed(*args)
  File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/accelerate/accelerator.py", line 1842, in _prepare_deepspeed
    engine, optimizer, _, lr_scheduler = ds_initialize(**kwargs)
  File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/deepspeed/__init__.py", line 193, in initialize
    engine = DeepSpeedEngine(args=args,
  File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/deepspeed/runtime/engine.py", line 313, in __init__
    self._configure_optimizer(optimizer, model_parameters)
  File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/deepspeed/runtime/engine.py", line 1302, in _configure_optimizer
    self.optimizer = self._configure_zero_optimizer(basic_optimizer)
  File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/deepspeed/runtime/engine.py", line 1560, in _configure_zero_optimizer
    optimizer = DeepSpeedZeroOptimizer(
  File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/deepspeed/runtime/zero/stage_1_and_2.py", line 553, in __init__
    self._param_slice_mappings = self._create_param_mapping()
  File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/deepspeed/runtime/zero/stage_1_and_2.py", line 574, in _create_param_mapping
    lp_name = self.param_names[lp]
KeyError: Parameter containing:
tensor([[[[-1.9791e-02,  1.6388e-02,  7.2754e-02],
          [-1.4084e-02, -1.0040e-01,  8.7036e-02],
          [-1.2848e-02, -1.1009e-02,  1.2794e-02]],

         [[ 2.8076e-02, -5.3467e-02, -3.5419e-03],
          [ 9.9731e-02, -9.3994e-02, -3.8147e-02],
          [ 8.7585e-03, -1.1116e-02,  1.3245e-02]],

         [[ 2.2354e-02, -2.3132e-02,  4.2206e-02],
          [-1.7166e-02,  9.6588e-03,  3.4180e-02],
          [-2.6455e-03, -2.2259e-03, -1.7029e-02]],

         ...,

         [[ 1.6832e-03, -3.7231e-03, -6.2943e-04],
          [ 4.2648e-03, -4.6005e-03,  2.2411e-03],
          [ 3.9520e-03,  3.2520e-03, -1.0580e-04]],

         [[ 8.7976e-04, -4.4556e-03, -3.3398e-03],
          [-1.7672e-03,  9.8190e-03,  8.0032e-03],
          [-2.3365e-03, -2.0428e-03, -5.0583e-03]],

         [[ 3.5930e-04,  5.3291e-03,  2.0657e-03],
          [ 8.0490e-03,  4.3945e-03, -7.1831e-03],
          [ 3.3855e-04, -5.1613e-03,  3.9444e-03]]],


        [[[ 2.3651e-03, -6.7444e-03, -1.1772e-02],
          [ 3.5534e-03,  3.8696e-02,  8.0994e-02],
          [-9.4366e-04,  1.0536e-02,  1.0399e-02]],

         [[-1.3161e-03, -9.4032e-04, -1.2062e-02],
          [-2.0409e-03,  4.7699e-02,  7.8735e-03],
          [-7.0496e-03,  1.7517e-02,  1.6357e-02]],

         [[-6.7282e-04,  1.6098e-02, -7.4120e-03],
          [ 5.6915e-03, -1.1035e-01, -9.5749e-03],
          [ 7.3013e-03, -2.9739e-02, -8.2092e-03]],

         ...,

         [[-4.1962e-04,  7.6723e-04,  6.3992e-04],
          [ 2.0142e-03,  3.8204e-03, -1.5187e-04],
          [-3.0661e-04,  2.6340e-03,  3.1292e-05]],

         [[ 3.6573e-04, -3.6049e-04,  2.7776e-04],
          [ 1.2569e-03,  1.0099e-03,  8.1062e-04],
          [ 4.1032e-04,  1.0271e-03, -1.5247e-04]],

         [[-8.3685e-04, -2.1572e-03,  7.8344e-04],
          [-1.2865e-03,  3.7613e-03,  6.6328e-04],
          [-6.7520e-04, -2.5711e-03,  1.2598e-03]]],


        [[[-2.7786e-02, -1.9821e-02, -1.1932e-02],
          [ 3.2074e-02,  5.9052e-02, -1.3466e-03],
          [ 1.4214e-02,  3.5156e-02,  2.6657e-02]],

         [[-1.6623e-03,  2.0203e-02,  8.5831e-03],
          [ 2.6459e-02, -7.8796e-02, -4.1870e-02],
          [-2.3071e-02,  8.9493e-03, -7.9346e-03]],

         [[ 9.2793e-04,  3.9612e-02, -2.4295e-04],
          [-3.2654e-02,  9.1980e-02, -2.6596e-02],
          [ 2.5158e-03, -3.6407e-02, -7.8506e-03]],

         ...,

         [[ 1.9646e-03,  4.4899e-03,  1.8930e-03],
          [ 7.9880e-03,  3.9339e-06,  2.0599e-03],
          [-6.3562e-04,  3.4657e-03,  5.4665e-03]],

         [[ 7.0858e-04,  3.9978e-03, -2.7943e-04],
          [-1.9369e-03, -1.5274e-02,  3.9711e-03],
          [ 6.0892e-04,  1.3189e-03,  2.6112e-03]],

         [[ 3.2387e-03,  6.1684e-03,  1.4830e-03],
          [ 4.6120e-03,  1.7365e-02,  8.7690e-04],
          [ 1.0669e-04,  2.8267e-03, -2.6741e-03]]],


        ...,


        [[[ 6.8054e-03,  2.9556e-02,  3.1948e-03],
          [ 2.9037e-02,  7.7393e-02,  8.9951e-03],
          [ 1.5106e-02, -4.5090e-03,  1.8646e-02]],

         [[ 5.2643e-03,  3.4668e-02,  2.0981e-02],
          [ 2.5314e-02,  7.7881e-02, -2.5597e-03],
          [-1.2596e-02,  4.9561e-02,  2.3785e-03]],

         [[ 4.1687e-02,  2.8000e-02,  4.1992e-02],
          [ 4.1626e-02, -7.9880e-03,  6.1707e-02],
          [ 4.3304e-02,  1.5335e-02,  7.1106e-02]],

         ...,

         [[-1.2684e-04, -2.1114e-03, -3.8147e-04],
          [-2.4815e-03, -5.1498e-03,  8.1682e-04],
          [ 2.6398e-03,  4.8256e-03, -4.3797e-04]],

         [[-1.1692e-03, -4.0512e-03, -1.0624e-03],
          [-1.1263e-03,  3.2101e-03,  3.9406e-03],
          [-8.9931e-04, -2.6188e-03, -2.9526e-03]],

         [[ 2.4910e-03,  1.3990e-03,  3.1543e-04],
          [-3.5572e-03,  6.8054e-03, -2.9354e-03],
          [ 9.4843e-04, -4.1809e-03, -7.8630e-04]]],


        [[[-3.0918e-03,  4.2000e-03, -5.5933e-04],
          [ 2.6489e-02, -2.8885e-02,  1.7654e-02],
          [ 3.7613e-03,  2.7023e-02, -4.4281e-02]],

         [[-2.6169e-02, -1.6022e-02, -6.4774e-03],
          [ 1.0674e-02,  3.1281e-02,  2.7481e-02],
          [ 4.9934e-03,  2.6428e-02,  2.6584e-04]],

         [[ 3.3997e-02, -7.9575e-03,  1.6968e-02],
          [ 2.3232e-03,  2.5696e-02,  1.9274e-03],
          [-2.0035e-02, -5.0842e-02, -4.9103e-02]],

         ...,

         [[-3.0632e-03,  1.4198e-04, -8.0585e-04],
          [ 1.0635e-02, -5.1575e-03,  7.7391e-04],
          [-5.7526e-03,  8.5878e-04, -2.5043e-03]],

         [[ 1.3161e-03, -5.3310e-04,  3.2139e-03],
          [-1.1559e-03, -1.1879e-02, -4.7874e-03],
          [ 7.4434e-04, -8.0156e-04, -3.6983e-03]],

         [[-4.8752e-03, -8.3389e-03, -2.3079e-03],
          [-1.5526e-03,  1.5335e-02, -5.5580e-03],
          [-2.1057e-03, -6.0349e-03,  7.6532e-04]]],


        [[[-6.5735e-02, -6.4331e-02, -2.0920e-02],
          [ 4.8615e-02, -1.2619e-02,  1.8219e-02],
          [ 2.1545e-02,  2.9087e-03,  2.1118e-02]],

         [[ 6.7993e-02,  3.1677e-02,  1.5976e-02],
          [ 5.8960e-02,  2.3670e-03, -6.7940e-03],
          [-2.8717e-02,  2.2545e-03, -3.5065e-02]],

         [[-2.8473e-02, -5.0842e-02, -4.1718e-02],
          [-2.3392e-02, -1.7151e-02, -3.8818e-02],
          [-1.2770e-03, -1.6983e-02, -1.3756e-02]],

         ...,

         [[-8.5783e-04,  3.8509e-03,  1.1015e-03],
          [-9.1782e-03,  1.8051e-02,  3.4523e-03],
          [ 1.7703e-05, -1.0490e-03, -1.4563e-03]],

         [[-5.3444e-03,  3.5610e-03,  2.1780e-04],
          [-3.6860e-04,  7.2632e-03,  9.3155e-03],
          [-1.2150e-03,  9.0714e-03,  3.9940e-03]],

         [[ 2.9984e-03,  1.4906e-03,  2.5673e-03],
          [-3.2463e-03, -1.2054e-02, -2.1420e-03],
          [ 2.5654e-03, -1.3161e-03,  3.3340e-03]]]], device='cuda:0',
       requires_grad=True)
[rank0]: Traceback (most recent call last):
[rank0]:   File "/fs/nexus-scratch/sjxu/svd-temporal-controlnet/train_svd_con.py", line 1911, in <module>
[rank0]:     main()
[rank0]:   File "/fs/nexus-scratch/sjxu/svd-temporal-controlnet/train_svd_con.py", line 1178, in main
[rank0]:     controlnet, optimizer, lr_scheduler, train_dataloader = accelerator.prepare(
[rank0]:   File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/accelerate/accelerator.py", line 1323, in prepare
[rank0]:     result = self._prepare_deepspeed(*args)
[rank0]:   File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/accelerate/accelerator.py", line 1842, in _prepare_deepspeed
[rank0]:     engine, optimizer, _, lr_scheduler = ds_initialize(**kwargs)
[rank0]:   File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/deepspeed/__init__.py", line 193, in initialize
[rank0]:     engine = DeepSpeedEngine(args=args,
[rank0]:   File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/deepspeed/runtime/engine.py", line 313, in __init__
[rank0]:     self._configure_optimizer(optimizer, model_parameters)
[rank0]:   File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/deepspeed/runtime/engine.py", line 1302, in _configure_optimizer
[rank0]:     self.optimizer = self._configure_zero_optimizer(basic_optimizer)
[rank0]:   File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/deepspeed/runtime/engine.py", line 1560, in _configure_zero_optimizer
[rank0]:     optimizer = DeepSpeedZeroOptimizer(
[rank0]:   File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/deepspeed/runtime/zero/stage_1_and_2.py", line 553, in __init__
[rank0]:     self._param_slice_mappings = self._create_param_mapping()
[rank0]:   File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/deepspeed/runtime/zero/stage_1_and_2.py", line 574, in _create_param_mapping
[rank0]:     lp_name = self.param_names[lp]
[rank0]: KeyError: Parameter containing:
[rank0]: tensor([[[[-1.9791e-02,  1.6388e-02,  7.2754e-02],
[rank0]:           [-1.4084e-02, -1.0040e-01,  8.7036e-02],
[rank0]:           [-1.2848e-02, -1.1009e-02,  1.2794e-02]],

[rank0]:          [[ 2.8076e-02, -5.3467e-02, -3.5419e-03],
[rank0]:           [ 9.9731e-02, -9.3994e-02, -3.8147e-02],
[rank0]:           [ 8.7585e-03, -1.1116e-02,  1.3245e-02]],

[rank0]:          [[ 2.2354e-02, -2.3132e-02,  4.2206e-02],
[rank0]:           [-1.7166e-02,  9.6588e-03,  3.4180e-02],
[rank0]:           [-2.6455e-03, -2.2259e-03, -1.7029e-02]],

[rank0]:          ...,

[rank0]:          [[ 1.6832e-03, -3.7231e-03, -6.2943e-04],
[rank0]:           [ 4.2648e-03, -4.6005e-03,  2.2411e-03],
[rank0]:           [ 3.9520e-03,  3.2520e-03, -1.0580e-04]],

[rank0]:          [[ 8.7976e-04, -4.4556e-03, -3.3398e-03],
[rank0]:           [-1.7672e-03,  9.8190e-03,  8.0032e-03],
[rank0]:           [-2.3365e-03, -2.0428e-03, -5.0583e-03]],

[rank0]:          [[ 3.5930e-04,  5.3291e-03,  2.0657e-03],
[rank0]:           [ 8.0490e-03,  4.3945e-03, -7.1831e-03],
[rank0]:           [ 3.3855e-04, -5.1613e-03,  3.9444e-03]]],


[rank0]:         [[[ 2.3651e-03, -6.7444e-03, -1.1772e-02],
[rank0]:           [ 3.5534e-03,  3.8696e-02,  8.0994e-02],
[rank0]:           [-9.4366e-04,  1.0536e-02,  1.0399e-02]],

[rank0]:          [[-1.3161e-03, -9.4032e-04, -1.2062e-02],
[rank0]:           [-2.0409e-03,  4.7699e-02,  7.8735e-03],
[rank0]:           [-7.0496e-03,  1.7517e-02,  1.6357e-02]],

[rank0]:          [[-6.7282e-04,  1.6098e-02, -7.4120e-03],
[rank0]:           [ 5.6915e-03, -1.1035e-01, -9.5749e-03],
[rank0]:           [ 7.3013e-03, -2.9739e-02, -8.2092e-03]],

[rank0]:          ...,

[rank0]:          [[-4.1962e-04,  7.6723e-04,  6.3992e-04],
[rank0]:           [ 2.0142e-03,  3.8204e-03, -1.5187e-04],
[rank0]:           [-3.0661e-04,  2.6340e-03,  3.1292e-05]],

[rank0]:          [[ 3.6573e-04, -3.6049e-04,  2.7776e-04],
[rank0]:           [ 1.2569e-03,  1.0099e-03,  8.1062e-04],
[rank0]:           [ 4.1032e-04,  1.0271e-03, -1.5247e-04]],

[rank0]:          [[-8.3685e-04, -2.1572e-03,  7.8344e-04],
[rank0]:           [-1.2865e-03,  3.7613e-03,  6.6328e-04],
[rank0]:           [-6.7520e-04, -2.5711e-03,  1.2598e-03]]],


[rank0]:         [[[-2.7786e-02, -1.9821e-02, -1.1932e-02],
[rank0]:           [ 3.2074e-02,  5.9052e-02, -1.3466e-03],
[rank0]:           [ 1.4214e-02,  3.5156e-02,  2.6657e-02]],

[rank0]:          [[-1.6623e-03,  2.0203e-02,  8.5831e-03],
[rank0]:           [ 2.6459e-02, -7.8796e-02, -4.1870e-02],
[rank0]:           [-2.3071e-02,  8.9493e-03, -7.9346e-03]],

[rank0]:          [[ 9.2793e-04,  3.9612e-02, -2.4295e-04],
[rank0]:           [-3.2654e-02,  9.1980e-02, -2.6596e-02],
[rank0]:           [ 2.5158e-03, -3.6407e-02, -7.8506e-03]],

[rank0]:          ...,

[rank0]:          [[ 1.9646e-03,  4.4899e-03,  1.8930e-03],
[rank0]:           [ 7.9880e-03,  3.9339e-06,  2.0599e-03],
[rank0]:           [-6.3562e-04,  3.4657e-03,  5.4665e-03]],

[rank0]:          [[ 7.0858e-04,  3.9978e-03, -2.7943e-04],
[rank0]:           [-1.9369e-03, -1.5274e-02,  3.9711e-03],
[rank0]:           [ 6.0892e-04,  1.3189e-03,  2.6112e-03]],

[rank0]:          [[ 3.2387e-03,  6.1684e-03,  1.4830e-03],
[rank0]:           [ 4.6120e-03,  1.7365e-02,  8.7690e-04],
[rank0]:           [ 1.0669e-04,  2.8267e-03, -2.6741e-03]]],


[rank0]:         ...,


[rank0]:         [[[ 6.8054e-03,  2.9556e-02,  3.1948e-03],
[rank0]:           [ 2.9037e-02,  7.7393e-02,  8.9951e-03],
[rank0]:           [ 1.5106e-02, -4.5090e-03,  1.8646e-02]],

[rank0]:          [[ 5.2643e-03,  3.4668e-02,  2.0981e-02],
[rank0]:           [ 2.5314e-02,  7.7881e-02, -2.5597e-03],
[rank0]:           [-1.2596e-02,  4.9561e-02,  2.3785e-03]],

[rank0]:          [[ 4.1687e-02,  2.8000e-02,  4.1992e-02],
[rank0]:           [ 4.1626e-02, -7.9880e-03,  6.1707e-02],
[rank0]:           [ 4.3304e-02,  1.5335e-02,  7.1106e-02]],

[rank0]:          ...,

[rank0]:          [[-1.2684e-04, -2.1114e-03, -3.8147e-04],
[rank0]:           [-2.4815e-03, -5.1498e-03,  8.1682e-04],
[rank0]:           [ 2.6398e-03,  4.8256e-03, -4.3797e-04]],

[rank0]:          [[-1.1692e-03, -4.0512e-03, -1.0624e-03],
[rank0]:           [-1.1263e-03,  3.2101e-03,  3.9406e-03],
[rank0]:           [-8.9931e-04, -2.6188e-03, -2.9526e-03]],

[rank0]:          [[ 2.4910e-03,  1.3990e-03,  3.1543e-04],
[rank0]:           [-3.5572e-03,  6.8054e-03, -2.9354e-03],
[rank0]:           [ 9.4843e-04, -4.1809e-03, -7.8630e-04]]],


[rank0]:         [[[-3.0918e-03,  4.2000e-03, -5.5933e-04],
[rank0]:           [ 2.6489e-02, -2.8885e-02,  1.7654e-02],
[rank0]:           [ 3.7613e-03,  2.7023e-02, -4.4281e-02]],

[rank0]:          [[-2.6169e-02, -1.6022e-02, -6.4774e-03],
[rank0]:           [ 1.0674e-02,  3.1281e-02,  2.7481e-02],
[rank0]:           [ 4.9934e-03,  2.6428e-02,  2.6584e-04]],

[rank0]:          [[ 3.3997e-02, -7.9575e-03,  1.6968e-02],
[rank0]:           [ 2.3232e-03,  2.5696e-02,  1.9274e-03],
[rank0]:           [-2.0035e-02, -5.0842e-02, -4.9103e-02]],

[rank0]:          ...,

[rank0]:          [[-3.0632e-03,  1.4198e-04, -8.0585e-04],
[rank0]:           [ 1.0635e-02, -5.1575e-03,  7.7391e-04],
[rank0]:           [-5.7526e-03,  8.5878e-04, -2.5043e-03]],

[rank0]:          [[ 1.3161e-03, -5.3310e-04,  3.2139e-03],
[rank0]:           [-1.1559e-03, -1.1879e-02, -4.7874e-03],
[rank0]:           [ 7.4434e-04, -8.0156e-04, -3.6983e-03]],

[rank0]:          [[-4.8752e-03, -8.3389e-03, -2.3079e-03],
[rank0]:           [-1.5526e-03,  1.5335e-02, -5.5580e-03],
[rank0]:           [-2.1057e-03, -6.0349e-03,  7.6532e-04]]],


[rank0]:         [[[-6.5735e-02, -6.4331e-02, -2.0920e-02],
[rank0]:           [ 4.8615e-02, -1.2619e-02,  1.8219e-02],
[rank0]:           [ 2.1545e-02,  2.9087e-03,  2.1118e-02]],

[rank0]:          [[ 6.7993e-02,  3.1677e-02,  1.5976e-02],
[rank0]:           [ 5.8960e-02,  2.3670e-03, -6.7940e-03],
[rank0]:           [-2.8717e-02,  2.2545e-03, -3.5065e-02]],

[rank0]:          [[-2.8473e-02, -5.0842e-02, -4.1718e-02],
[rank0]:           [-2.3392e-02, -1.7151e-02, -3.8818e-02],
[rank0]:           [-1.2770e-03, -1.6983e-02, -1.3756e-02]],

[rank0]:          ...,

[rank0]:          [[-8.5783e-04,  3.8509e-03,  1.1015e-03],
[rank0]:           [-9.1782e-03,  1.8051e-02,  3.4523e-03],
[rank0]:           [ 1.7703e-05, -1.0490e-03, -1.4563e-03]],

[rank0]:          [[-5.3444e-03,  3.5610e-03,  2.1780e-04],
[rank0]:           [-3.6860e-04,  7.2632e-03,  9.3155e-03],
[rank0]:           [-1.2150e-03,  9.0714e-03,  3.9940e-03]],

[rank0]:          [[ 2.9984e-03,  1.4906e-03,  2.5673e-03],
[rank0]:           [-3.2463e-03, -1.2054e-02, -2.1420e-03],
[rank0]:           [ 2.5654e-03, -1.3161e-03,  3.3340e-03]]]], device='cuda:0',
[rank0]:        requires_grad=True)
E1129 17:06:05.040281 139874292712448 torch/distributed/elastic/multiprocessing/api.py:833] failed (exitcode: 1) local_rank: 0 (pid: 1752320) of binary: /fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/bin/python
Warning: The cache directory for DeepSpeed Triton autotune, /fs/nexus-scratch/sjxu/.triton/autotune, appears to be on an NFS system. While this is generally acceptable, if you experience slowdowns or hanging when DeepSpeed exits, it is recommended to set the TRITON_CACHE_DIR environment variable to a non-NFS path.
Traceback (most recent call last):
  File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/bin/accelerate", line 8, in <module>
    sys.exit(main())
  File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/accelerate/commands/accelerate_cli.py", line 48, in main
    args.func(args)
  File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/accelerate/commands/launch.py", line 1153, in launch_command
    deepspeed_launcher(args)
  File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/accelerate/commands/launch.py", line 846, in deepspeed_launcher
    distrib_run.run(args)
  File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/torch/distributed/run.py", line 892, in run
    elastic_launch(
  File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/torch/distributed/launcher/api.py", line 133, in __call__
    return launch_agent(self._config, self._entrypoint, list(args))
  File "/fs/nexus-scratch/sjxu/miniconda3/envs/svd_control/lib/python3.9/site-packages/torch/distributed/launcher/api.py", line 264, in launch_agent
    raise ChildFailedError(
torch.distributed.elastic.multiprocessing.errors.ChildFailedError: 
============================================================
train_svd_con.py FAILED
------------------------------------------------------------
Failures:
[1]:
  time      : 2024-11-29_17:06:05
  host      : gammagpu17.umiacs.umd.edu
  rank      : 1 (local_rank: 1)
  exitcode  : 1 (pid: 1752321)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
[2]:
  time      : 2024-11-29_17:06:05
  host      : gammagpu17.umiacs.umd.edu
  rank      : 2 (local_rank: 2)
  exitcode  : 1 (pid: 1752323)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
[3]:
  time      : 2024-11-29_17:06:05
  host      : gammagpu17.umiacs.umd.edu
  rank      : 3 (local_rank: 3)
  exitcode  : 1 (pid: 1752328)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
------------------------------------------------------------
Root Cause (first observed failure):
[0]:
  time      : 2024-11-29_17:06:05
  host      : gammagpu17.umiacs.umd.edu
  rank      : 0 (local_rank: 0)
  exitcode  : 1 (pid: 1752320)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
============================================================
srun: error: gammagpu17: task 0: Exited with exit code 1
